!function(t){var e={};function o(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";function s(t,e){return(e||document).querySelector(t)}function i(t,e,o){t.addEventListener(e,o)}function l(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}o.r(e);const n=new class{constructor(t,e){this.model=t,this.view=e,this.view.listenToggleAll(this.toggleAll.bind(this)),this.view.listenNewToDo(this.newToDo.bind(this)),this.view.listenToItemChange(this.endEditItem.bind(this)),this.view.listenToItemRemove(this.removeItem.bind(this)),this.view.listenToItemToggle(this.toggleItem.bind(this)),this.view.listenToRemoveCompleted(this.removeCompleted.bind(this))}setView(t=document.location.hash){const e=t.replace(/^#\//,"");let o;switch(e){case"active":o=this.model.getIncompleted();break;case"completed":o=this.model.getCompleted();break;default:o=this.model.todos}this.view.setToggleAllState(this.model.allComplete()),this.view.setChosenFilter(e),this.view.setMainVisibility(this.model.todos.length),this.view.setFooterVisibility(this.model.todos.length),this.view.setClearButtVisibility(this.model.getCompleted().length),this.view.renderList(o),this.view.updateActiveItemsField(this.model.getIncompleted().length)}newToDo(t){this.model.addItem(t),this.setView()}endEditItem(t,e){this.model.setItemTitle(t,e),this.setView()}toggleAll(t){this.model.setAllCompletion(t),this.setView()}toggleItem(t){this.model.toggleItem(t),this.setView()}removeItem(t){this.model.removeItem(t),this.setView()}removeCompleted(){this.model.removeCompleted(),this.setView()}}(new class{constructor(t){this.todos=[],this.pushToStorage=(()=>{localStorage.setItem(t,JSON.stringify(this.todos))}),this.pullFromStorage=(()=>{this.todos=JSON.parse(localStorage.getItem(t)||"[]")}),this.pullFromStorage()}getCompleted(){return this.todos.filter(t=>t.completed)}getIncompleted(){return this.todos.filter(t=>!t.completed)}setAllCompletion(t){this.todos.forEach(e=>{e.completed=t}),this.pushToStorage()}allComplete(){return this.getCompleted().length===this.todos.length}removeCompleted(){this.todos=this.getIncompleted(),this.pushToStorage()}addItem(t){if(t=t.trim()){const e={title:t,id:`${l()+l()}-${l()}-${l()}-${l()}-${l()}${l()}${l()}`,completed:!1};this.todos.push(e),this.pushToStorage()}}setItemTitle(t,e){t=t.trim();const o=this.todos.find(t=>Object.is(t.id,e));t?(o.title=t,this.pushToStorage()):this.removeItem(e)}removeItem(t){this.todos.forEach((e,o)=>{Object.is(e.id,t)&&this.todos.splice(o,1)}),this.pushToStorage()}toggleItem(t){this.todos.forEach(e=>{Object.is(e.id,t)&&(e.completed=!e.completed,this.pushToStorage())})}}("todo-astrielov"),new class{constructor(t){this.templates=t,this.sectionTodoapp=s(".todoapp"),this.sectionMain=s(".main",this.sectionTodoapp),this.inputNewTodo=s(".new-todo",this.sectionTodoapp),this.buttonToggleAll=s(".toggle-all",this.sectionTodoapp),this.buttonClearCompleted=s(".clear-completed",this.sectionTodoapp),this.ulTodoList=s(".todo-list",this.sectionTodoapp),this.counter=s(".todo-count",this.sectionTodoapp),this.footer=s(".footer",this.sectionTodoapp),this.filters=s(".filters",this.sectionTodoapp)}setMainVisibility(t){this.sectionMain.style.display=t?"block":"none"}setFooterVisibility(t){this.footer.style.display=t?"block":"none"}setClearButtVisibility(t){this.buttonClearCompleted.style.display=t?"block":"none"}setToggleAllState(t){this.buttonToggleAll.checked=t}setChosenFilter(t){let e;switch(this.filters.querySelectorAll("a").forEach(t=>t.classList.remove("selected")),t){case"active":e=s("#showActive",this.filters);break;case"completed":e=s("#showCompleted",this.filters);break;default:e=s("#showAll",this.filters)}e.classList.add("selected")}swapListContent(t){let e=this.ulTodoList.firstChild;for(;e;)this.ulTodoList.removeChild(e),e=this.ulTodoList.firstChild;this.ulTodoList.appendChild(t)}clearNewToDoInput(){this.inputNewTodo.value=""}listenToggleAll(t){i(this.buttonToggleAll,"click",()=>{const e=this.buttonToggleAll.checked;t(e)})}listenNewToDo(t){i(this.inputNewTodo,"change",()=>{const e=this.inputNewTodo.value.trim();e&&(this.clearNewToDoInput(),t(e))})}listenToItemChange(t){i(this.ulTodoList,"dblclick",({target:e})=>{if(!Object.is(e.tagName,"LABEL"))return;const o=e.parentElement.parentElement,s=document.createElement("input");s.classList.add("edit"),s.value=e.innerText,o.appendChild(s),o.classList.add("editing"),s.focus(),i(s,"blur",()=>{s.dataset.cancelled||t(s.value,o.dataset.id),o.classList.remove("editing"),o.removeChild(s)}),i(s,"keydown",t=>{"Escape"===t.key&&(s.dataset.cancelled="true",s.blur()),"Enter"===t.key&&s.blur()})})}listenToItemRemove(t){i(this.ulTodoList,"click",({target:e})=>{if(!e.classList.contains("destroy"))return;const o=e.parentElement.parentElement;t&&t(o.dataset.id)})}listenToRemoveCompleted(t){i(this.buttonClearCompleted,"click",()=>{t()})}listenToItemToggle(t){i(this.ulTodoList,"click",({target:e})=>{if(!e.classList.contains("toggle"))return;const o=e.parentElement.parentElement;o.classList.contains("completed")?o.classList.remove("completed"):o.classList.add("completed"),t&&t(o.dataset.id)})}renderList(t){const e=document.createDocumentFragment();t.forEach(t=>{const o=this.templates.constructor.newItemLi(t);e.appendChild(o)}),this.swapListContent(e)}updateActiveItemsField(t){const e=this.templates.constructor.newTodoCountSpan(t);this.counter.parentElement.replaceChild(e,this.counter),this.counter=e}}(new class{static newItemLi(t){const e=document.createElement("li");return e.dataset.id=t.id,e.innerHTML=`<div class="view">\n                      <input class="toggle" type="checkbox">\n                      <label>${t.title}</label>\n                      <button class="destroy"></button>\n                    </div>`,t.completed&&(e.classList.add("completed"),s(".toggle",e).checked=!0),e}static newTodoCountSpan(t){const e=document.createElement("span");return e.classList.add("todo-count"),e.innerHTML=`<strong>${t}</strong> item${t%10==1?"":"s"} left`,e}}));i(window,"load",()=>n.setView()),i(window,"hashchange",()=>n.setView())}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vanMvaGVscGVycy9oZWxwZXJzLmpzIiwid2VicGFjazovLy8uL2pzL2hlbHBlcnMvaWRHZW5lcmF0b3IuanMiLCJ3ZWJwYWNrOi8vLy4vanMvYXBwLmpzIiwid2VicGFjazovLy8uL2pzL2NvbnRyb2xsZXIvY29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly8vLi9qcy9tb2RlbC9zdG9yZU1vZGVsLmpzIiwid2VicGFjazovLy8uL2pzL3ZpZXcvdmlldy5qcyIsIndlYnBhY2s6Ly8vLi9qcy92aWV3L3RlbXBsYXRlcy5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJ2YWx1ZSIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwicXMiLCJzZWxlY3RvciIsInNjb3BlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2V0TGlzdGVuZXIiLCJ0YXJnZXQiLCJldmVudFR5cGUiLCJjYWxsYmFjayIsImFkZEV2ZW50TGlzdGVuZXIiLCJzNCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwiY29udHJvbGxlciIsIltvYmplY3QgT2JqZWN0XSIsIm1vZGVsIiwidmlldyIsInRoaXMiLCJsaXN0ZW5Ub2dnbGVBbGwiLCJ0b2dnbGVBbGwiLCJiaW5kIiwibGlzdGVuTmV3VG9EbyIsIm5ld1RvRG8iLCJsaXN0ZW5Ub0l0ZW1DaGFuZ2UiLCJlbmRFZGl0SXRlbSIsImxpc3RlblRvSXRlbVJlbW92ZSIsInJlbW92ZUl0ZW0iLCJsaXN0ZW5Ub0l0ZW1Ub2dnbGUiLCJ0b2dnbGVJdGVtIiwibGlzdGVuVG9SZW1vdmVDb21wbGV0ZWQiLCJyZW1vdmVDb21wbGV0ZWQiLCJyYXciLCJsb2NhdGlvbiIsImhhc2giLCJyb3V0ZSIsInJlcGxhY2UiLCJjdXJyZW50VG9kb3MiLCJnZXRJbmNvbXBsZXRlZCIsImdldENvbXBsZXRlZCIsInRvZG9zIiwic2V0VG9nZ2xlQWxsU3RhdGUiLCJhbGxDb21wbGV0ZSIsInNldENob3NlbkZpbHRlciIsInNldE1haW5WaXNpYmlsaXR5IiwibGVuZ3RoIiwic2V0Rm9vdGVyVmlzaWJpbGl0eSIsInNldENsZWFyQnV0dFZpc2liaWxpdHkiLCJyZW5kZXJMaXN0IiwidXBkYXRlQWN0aXZlSXRlbXNGaWVsZCIsInRpdGxlIiwiYWRkSXRlbSIsInNldFZpZXciLCJpZCIsInNldEl0ZW1UaXRsZSIsImNvbXBsZXRlZCIsInNldEFsbENvbXBsZXRpb24iLCJzdG9yYWdlVmFyTmFtZSIsInB1c2hUb1N0b3JhZ2UiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsInB1bGxGcm9tU3RvcmFnZSIsInBhcnNlIiwiZ2V0SXRlbSIsImZpbHRlciIsInRvZG8iLCJmb3JFYWNoIiwiaXRlbSIsInRyaW0iLCJwdXNoIiwiZmluZCIsImlzIiwiaW5kZXgiLCJzcGxpY2UiLCJ0ZW1wbGF0ZXMiLCJzZWN0aW9uVG9kb2FwcCIsInNlY3Rpb25NYWluIiwiaW5wdXROZXdUb2RvIiwiYnV0dG9uVG9nZ2xlQWxsIiwiYnV0dG9uQ2xlYXJDb21wbGV0ZWQiLCJ1bFRvZG9MaXN0IiwiY291bnRlciIsImZvb3RlciIsImZpbHRlcnMiLCJ2aXNpYmxlIiwic3R5bGUiLCJkaXNwbGF5IiwiY2hlY2tlZCIsImN1cnJCdXR0IiwicXVlcnlTZWxlY3RvckFsbCIsIm5vZGUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJmcmFnbWVudCIsImNoaWxkIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwiYXBwZW5kQ2hpbGQiLCJoYW5kbGVyIiwiY2xlYXJOZXdUb0RvSW5wdXQiLCJ0YWdOYW1lIiwibGkiLCJwYXJlbnRFbGVtZW50IiwiZWRpdCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lclRleHQiLCJmb2N1cyIsImRhdGFzZXQiLCJjYW5jZWxsZWQiLCJldmVudCIsImtleSIsImJsdXIiLCJjb250YWlucyIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJjb25zdHJ1Y3RvciIsIm5ld0l0ZW1MaSIsInN3YXBMaXN0Q29udGVudCIsImFjdGl2ZUl0ZW1zIiwibmV3Q291bnRlciIsIm5ld1RvZG9Db3VudFNwYW4iLCJyZXBsYWNlQ2hpbGQiLCJpbm5lckhUTUwiLCJpdGVtc0Ftb3VudCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQ0FLLGNBQUEsRUFDQUMsWUFBQSxFQUNBQyxJQUFBTixLQU1BWixFQUFBbUIsRUFBQSxTQUFBakIsR0FDQVksT0FBQUMsZUFBQWIsRUFBQSxjQUFpRGtCLE9BQUEsS0FJakRwQixFQUFBcUIsRUFBQSxTQUFBbEIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBbUIsV0FDQSxXQUEyQixPQUFBbkIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxH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LFFBQUF6RCxNQUtBdEMsV0FBQXlCLEdBQ0EsTUFBQXdELEVBQUEvRixTQUFBbUgseUJBQ0E1RSxFQUFBNEIsUUFBQUQsSUFDQSxNQUFBcUMsRUFBQXRGLEtBQUEwRCxVQUFBeUMsWUFBQUMsVUFBQW5ELEdBQ0E2QixFQUFBSSxZQUFBSSxLQUVBdEYsS0FBQXFHLGdCQUFBdkIsR0FHQWpGLHVCQUFBeUcsR0FDQSxNQUFBQyxFQUFBdkcsS0FBQTBELFVBQUF5QyxZQUFBSyxpQkFBQUYsR0FDQXRHLEtBQUFpRSxRQUFBc0IsY0FBQWtCLGFBQUFGLEVBQUF2RyxLQUFBaUUsU0FDQWpFLEtBQUFpRSxRQUFBc0MsSUg1SkEsVUlMQTFHLGlCQUFBb0QsR0FDQSxNQUFBcUMsRUFBQXZHLFNBQUEwRyxjQUFBLE1BZUEsT0FiQUgsRUFBQU0sUUFBQXpELEdBQUFjLEVBQUFkLEdBQ0FtRCxFQUFBb0IsNEhBRStCekQsRUFBQWpCLHFHQUkvQmlCLEVBQUFaLFlBQ0FpRCxFQUFBWCxVQUFBRSxJQUFBLGFBQ0FqRyxFQUFBLFVBQUEwRyxHQUFBZixTQUFBLEdBSUFlLEVBR0F6Rix3QkFBQThHLEdBQ0EsTUFBQTFDLEVBQUFsRixTQUFBMEcsY0FBQSxRQUtBLE9BSEF4QixFQUFBVSxVQUFBRSxJQUFBLGNBQ0FaLEVBQUF5QyxxQkFBbUNDLGtCQUE0QkEsRUFBQSxvQkFFL0QxQyxNSmZBaEYsRUFBQTJILE9BQUEsV0FBQWhILEVBQUFzQyxXQUNBakQsRUFBQTJILE9BQUEsaUJBQUFoSCxFQUFBc0MiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImV4cG9ydCBmdW5jdGlvbiBxcyhzZWxlY3Rvciwgc2NvcGUpIHtcbiAgcmV0dXJuIChzY29wZSB8fCBkb2N1bWVudCkucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRMaXN0ZW5lcih0YXJnZXQsIGV2ZW50VHlwZSwgY2FsbGJhY2spIHtcbiAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBjYWxsYmFjayk7XG59XG4iLCJmdW5jdGlvbiBzNCgpIHtcbiAgcmV0dXJuIE1hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApXG4gICAgLnRvU3RyaW5nKDE2KVxuICAgIC5zdWJzdHJpbmcoMSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGdlbmVyVW5pcUlkKCkge1xuICByZXR1cm4gYCR7czQoKSArIHM0KCl9LSR7czQoKX0tJHtzNCgpfS0ke3M0KCl9LSR7czQoKX0ke3M0KCl9JHtzNCgpfWA7XG59XG4iLCJpbXBvcnQgeyBzZXRMaXN0ZW5lciB9IGZyb20gJy4vaGVscGVycy9oZWxwZXJzJztcbmltcG9ydCBTdG9yZU1vZGVsIGZyb20gJy4vbW9kZWwvc3RvcmVNb2RlbCc7XG5pbXBvcnQgVGVtcGxhdGVzIGZyb20gJy4vdmlldy90ZW1wbGF0ZXMnO1xuaW1wb3J0IFZpZXcgZnJvbSAnLi92aWV3L3ZpZXcnO1xuaW1wb3J0IENvbnRyb2xsZXIgZnJvbSAnLi9jb250cm9sbGVyL2NvbnRyb2xsZXInO1xuXG5jb25zdCBtb2RlbCA9IG5ldyBTdG9yZU1vZGVsKCd0b2RvLWFzdHJpZWxvdicpO1xuXG5jb25zdCB0ZW1wbGF0ZXMgPSBuZXcgVGVtcGxhdGVzKCk7XG5jb25zdCB2aWV3ID0gbmV3IFZpZXcodGVtcGxhdGVzKTtcblxuY29uc3QgY29udHJvbGxlciA9IG5ldyBDb250cm9sbGVyKG1vZGVsLCB2aWV3KTtcblxuc2V0TGlzdGVuZXIod2luZG93LCAnbG9hZCcsICgpID0+IGNvbnRyb2xsZXIuc2V0VmlldygpKTtcbnNldExpc3RlbmVyKHdpbmRvdywgJ2hhc2hjaGFuZ2UnLCAoKSA9PiBjb250cm9sbGVyLnNldFZpZXcoKSk7XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IobW9kZWwsIHZpZXcpIHtcbiAgICB0aGlzLm1vZGVsID0gbW9kZWw7XG4gICAgdGhpcy52aWV3ID0gdmlldztcblxuICAgIHRoaXMudmlldy5saXN0ZW5Ub2dnbGVBbGwodGhpcy50b2dnbGVBbGwuYmluZCh0aGlzKSk7XG4gICAgdGhpcy52aWV3Lmxpc3Rlbk5ld1RvRG8odGhpcy5uZXdUb0RvLmJpbmQodGhpcykpO1xuICAgIHRoaXMudmlldy5saXN0ZW5Ub0l0ZW1DaGFuZ2UodGhpcy5lbmRFZGl0SXRlbS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnZpZXcubGlzdGVuVG9JdGVtUmVtb3ZlKHRoaXMucmVtb3ZlSXRlbS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnZpZXcubGlzdGVuVG9JdGVtVG9nZ2xlKHRoaXMudG9nZ2xlSXRlbS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnZpZXcubGlzdGVuVG9SZW1vdmVDb21wbGV0ZWQodGhpcy5yZW1vdmVDb21wbGV0ZWQuYmluZCh0aGlzKSk7XG4gIH1cblxuICBzZXRWaWV3KHJhdyA9IGRvY3VtZW50LmxvY2F0aW9uLmhhc2gpIHtcbiAgICBjb25zdCByb3V0ZSA9IHJhdy5yZXBsYWNlKC9eI1xcLy8sICcnKTtcbiAgICBsZXQgY3VycmVudFRvZG9zO1xuICAgIHN3aXRjaCAocm91dGUpIHtcbiAgICAgIGNhc2UgJ2FjdGl2ZSc6XG4gICAgICAgIGN1cnJlbnRUb2RvcyA9IHRoaXMubW9kZWwuZ2V0SW5jb21wbGV0ZWQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdjb21wbGV0ZWQnOlxuICAgICAgICBjdXJyZW50VG9kb3MgPSB0aGlzLm1vZGVsLmdldENvbXBsZXRlZCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGN1cnJlbnRUb2RvcyA9IHRoaXMubW9kZWwudG9kb3M7XG4gICAgfVxuICAgIHRoaXMudmlldy5zZXRUb2dnbGVBbGxTdGF0ZSh0aGlzLm1vZGVsLmFsbENvbXBsZXRlKCkpO1xuICAgIHRoaXMudmlldy5zZXRDaG9zZW5GaWx0ZXIocm91dGUpO1xuICAgIHRoaXMudmlldy5zZXRNYWluVmlzaWJpbGl0eSh0aGlzLm1vZGVsLnRvZG9zLmxlbmd0aCk7XG4gICAgdGhpcy52aWV3LnNldEZvb3RlclZpc2liaWxpdHkodGhpcy5tb2RlbC50b2Rvcy5sZW5ndGgpO1xuICAgIHRoaXMudmlldy5zZXRDbGVhckJ1dHRWaXNpYmlsaXR5KHRoaXMubW9kZWwuZ2V0Q29tcGxldGVkKCkubGVuZ3RoKTtcbiAgICB0aGlzLnZpZXcucmVuZGVyTGlzdChjdXJyZW50VG9kb3MpO1xuICAgIHRoaXMudmlldy51cGRhdGVBY3RpdmVJdGVtc0ZpZWxkKHRoaXMubW9kZWwuZ2V0SW5jb21wbGV0ZWQoKS5sZW5ndGgpO1xuICB9XG5cbiAgbmV3VG9Ebyh0aXRsZSkge1xuICAgIHRoaXMubW9kZWwuYWRkSXRlbSh0aXRsZSk7XG4gICAgdGhpcy5zZXRWaWV3KCk7XG4gIH1cblxuICBlbmRFZGl0SXRlbSh0aXRsZSwgaWQpIHtcbiAgICB0aGlzLm1vZGVsLnNldEl0ZW1UaXRsZSh0aXRsZSwgaWQpO1xuICAgIHRoaXMuc2V0VmlldygpO1xuICB9XG5cbiAgdG9nZ2xlQWxsKGNvbXBsZXRlZCkge1xuICAgIHRoaXMubW9kZWwuc2V0QWxsQ29tcGxldGlvbihjb21wbGV0ZWQpO1xuICAgIHRoaXMuc2V0VmlldygpO1xuICB9XG5cbiAgdG9nZ2xlSXRlbShpZCkge1xuICAgIHRoaXMubW9kZWwudG9nZ2xlSXRlbShpZCk7XG4gICAgdGhpcy5zZXRWaWV3KCk7XG4gIH1cblxuICByZW1vdmVJdGVtKGlkKSB7XG4gICAgdGhpcy5tb2RlbC5yZW1vdmVJdGVtKGlkKTtcbiAgICB0aGlzLnNldFZpZXcoKTtcbiAgfVxuXG4gIHJlbW92ZUNvbXBsZXRlZCgpIHtcbiAgICB0aGlzLm1vZGVsLnJlbW92ZUNvbXBsZXRlZCgpO1xuICAgIHRoaXMuc2V0VmlldygpO1xuICB9XG59XG4iLCJpbXBvcnQgZ2VuZXJVbmlxSWQgZnJvbSAnLi4vaGVscGVycy9pZEdlbmVyYXRvcic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0b3JlTW9kZWwge1xuICBjb25zdHJ1Y3RvcihzdG9yYWdlVmFyTmFtZSkge1xuICAgIHRoaXMudG9kb3MgPSBbXTtcblxuICAgIHRoaXMucHVzaFRvU3RvcmFnZSA9ICgpID0+IHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHN0b3JhZ2VWYXJOYW1lLCBKU09OLnN0cmluZ2lmeSh0aGlzLnRvZG9zKSk7XG4gICAgfTtcblxuICAgIHRoaXMucHVsbEZyb21TdG9yYWdlID0gKCkgPT4ge1xuICAgICAgdGhpcy50b2RvcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oc3RvcmFnZVZhck5hbWUpIHx8ICdbXScpO1xuICAgIH07XG5cbiAgICB0aGlzLnB1bGxGcm9tU3RvcmFnZSgpO1xuICB9XG5cbiAgZ2V0Q29tcGxldGVkKCkge1xuICAgIHJldHVybiB0aGlzLnRvZG9zLmZpbHRlcih0b2RvID0+IHRvZG8uY29tcGxldGVkKTtcbiAgfVxuXG4gIGdldEluY29tcGxldGVkKCkge1xuICAgIHJldHVybiB0aGlzLnRvZG9zLmZpbHRlcih0b2RvID0+ICF0b2RvLmNvbXBsZXRlZCk7XG4gIH1cblxuICBzZXRBbGxDb21wbGV0aW9uKGNvbXBsZXRlZCkge1xuICAgIHRoaXMudG9kb3MuZm9yRWFjaCgoaXRlbSkgPT4geyBpdGVtLmNvbXBsZXRlZCA9IGNvbXBsZXRlZDsgfSk7XG4gICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gIH1cblxuICBhbGxDb21wbGV0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRDb21wbGV0ZWQoKS5sZW5ndGggPT09IHRoaXMudG9kb3MubGVuZ3RoO1xuICB9XG5cbiAgcmVtb3ZlQ29tcGxldGVkKCkge1xuICAgIHRoaXMudG9kb3MgPSB0aGlzLmdldEluY29tcGxldGVkKCk7XG4gICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gIH1cblxuICBhZGRJdGVtKHRpdGxlKSB7XG4gICAgdGl0bGUgPSB0aXRsZS50cmltKCk7XG4gICAgaWYgKHRpdGxlKSB7XG4gICAgICBjb25zdCBpdGVtID0ge1xuICAgICAgICB0aXRsZSxcbiAgICAgICAgaWQ6IGdlbmVyVW5pcUlkKCksXG4gICAgICAgIGNvbXBsZXRlZDogZmFsc2UsXG4gICAgICB9O1xuICAgICAgdGhpcy50b2Rvcy5wdXNoKGl0ZW0pO1xuICAgICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0SXRlbVRpdGxlKHRpdGxlLCBpZCkge1xuICAgIHRpdGxlID0gdGl0bGUudHJpbSgpO1xuICAgIGNvbnN0IHRvZG8gPSB0aGlzLnRvZG9zLmZpbmQoaXRlbSA9PiBPYmplY3QuaXMoaXRlbS5pZCwgaWQpKTtcbiAgICBpZiAodGl0bGUpIHtcbiAgICAgIHRvZG8udGl0bGUgPSB0aXRsZTtcbiAgICAgIHRoaXMucHVzaFRvU3RvcmFnZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbW92ZUl0ZW0oaWQpO1xuICAgIH1cbiAgfVxuXG4gIHJlbW92ZUl0ZW0oaWQpIHtcbiAgICB0aGlzLnRvZG9zLmZvckVhY2goKHRvZG8sIGluZGV4KSA9PiB7XG4gICAgICBpZiAoT2JqZWN0LmlzKHRvZG8uaWQsIGlkKSkge1xuICAgICAgICB0aGlzLnRvZG9zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gIH1cblxuICB0b2dnbGVJdGVtKGlkKSB7XG4gICAgdGhpcy50b2Rvcy5mb3JFYWNoKCh0b2RvKSA9PiB7XG4gICAgICBpZiAoT2JqZWN0LmlzKHRvZG8uaWQsIGlkKSkge1xuICAgICAgICB0b2RvLmNvbXBsZXRlZCA9ICF0b2RvLmNvbXBsZXRlZDtcbiAgICAgICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiIsIi8qIGVzbGludC1kaXNhYmxlIG5vLWV4dHJhLWJvb2xlYW4tY2FzdCAqL1xuaW1wb3J0IHsgcXMsIHNldExpc3RlbmVyIH0gZnJvbSAnLi4vaGVscGVycy9oZWxwZXJzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmlldyB7XG4gIGNvbnN0cnVjdG9yKHRlbXBsYXRlcykge1xuICAgIHRoaXMudGVtcGxhdGVzID0gdGVtcGxhdGVzO1xuICAgIHRoaXMuc2VjdGlvblRvZG9hcHAgPSBxcygnLnRvZG9hcHAnKTtcbiAgICB0aGlzLnNlY3Rpb25NYWluID0gcXMoJy5tYWluJywgdGhpcy5zZWN0aW9uVG9kb2FwcCk7XG4gICAgdGhpcy5pbnB1dE5ld1RvZG8gPSBxcygnLm5ldy10b2RvJywgdGhpcy5zZWN0aW9uVG9kb2FwcCk7XG4gICAgdGhpcy5idXR0b25Ub2dnbGVBbGwgPSBxcygnLnRvZ2dsZS1hbGwnLCB0aGlzLnNlY3Rpb25Ub2RvYXBwKTtcbiAgICB0aGlzLmJ1dHRvbkNsZWFyQ29tcGxldGVkID0gcXMoJy5jbGVhci1jb21wbGV0ZWQnLCB0aGlzLnNlY3Rpb25Ub2RvYXBwKTtcbiAgICB0aGlzLnVsVG9kb0xpc3QgPSBxcygnLnRvZG8tbGlzdCcsIHRoaXMuc2VjdGlvblRvZG9hcHApO1xuICAgIHRoaXMuY291bnRlciA9IHFzKCcudG9kby1jb3VudCcsIHRoaXMuc2VjdGlvblRvZG9hcHApO1xuICAgIHRoaXMuZm9vdGVyID0gcXMoJy5mb290ZXInLCB0aGlzLnNlY3Rpb25Ub2RvYXBwKTtcbiAgICB0aGlzLmZpbHRlcnMgPSBxcygnLmZpbHRlcnMnLCB0aGlzLnNlY3Rpb25Ub2RvYXBwKTtcbiAgfVxuXG4gIHNldE1haW5WaXNpYmlsaXR5KHZpc2libGUpIHtcbiAgICB0aGlzLnNlY3Rpb25NYWluLnN0eWxlLmRpc3BsYXkgPSAhIXZpc2libGUgPyAnYmxvY2snIDogJ25vbmUnO1xuICB9XG5cbiAgc2V0Rm9vdGVyVmlzaWJpbGl0eSh2aXNpYmxlKSB7XG4gICAgdGhpcy5mb290ZXIuc3R5bGUuZGlzcGxheSA9ICEhdmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZSc7XG4gIH1cblxuICBzZXRDbGVhckJ1dHRWaXNpYmlsaXR5KHZpc2libGUpIHtcbiAgICB0aGlzLmJ1dHRvbkNsZWFyQ29tcGxldGVkLnN0eWxlLmRpc3BsYXkgPSAhIXZpc2libGUgPyAnYmxvY2snIDogJ25vbmUnO1xuICB9XG5cbiAgc2V0VG9nZ2xlQWxsU3RhdGUoYWxsQ29tcGxldGUpIHtcbiAgICB0aGlzLmJ1dHRvblRvZ2dsZUFsbC5jaGVja2VkID0gYWxsQ29tcGxldGU7XG4gIH1cblxuICBzZXRDaG9zZW5GaWx0ZXIocm91dGUpIHtcbiAgICB0aGlzLmZpbHRlcnMucXVlcnlTZWxlY3RvckFsbCgnYScpLmZvckVhY2gobm9kZSA9PiBub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJykpO1xuICAgIGxldCBjdXJyQnV0dDtcbiAgICBzd2l0Y2ggKHJvdXRlKSB7XG4gICAgICBjYXNlICdhY3RpdmUnOlxuICAgICAgICBjdXJyQnV0dCA9IHFzKCcjc2hvd0FjdGl2ZScsIHRoaXMuZmlsdGVycyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnY29tcGxldGVkJzpcbiAgICAgICAgY3VyckJ1dHQgPSBxcygnI3Nob3dDb21wbGV0ZWQnLCB0aGlzLmZpbHRlcnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGN1cnJCdXR0ID0gcXMoJyNzaG93QWxsJywgdGhpcy5maWx0ZXJzKTtcbiAgICB9XG4gICAgY3VyckJ1dHQuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaXBlIG9sZCBUb0RvcyBhbmQgcGFzdGUgdGhlIG5ldyBvbmVzXG4gICAqIEBwYXJhbSBmcmFnbWVudCAtIGRvY3VtZW50RnJhZ21lbnRcbiAgICovXG4gIHN3YXBMaXN0Q29udGVudChmcmFnbWVudCkge1xuICAgIGxldCBjaGlsZCA9IHRoaXMudWxUb2RvTGlzdC5maXJzdENoaWxkO1xuICAgIHdoaWxlIChjaGlsZCkge1xuICAgICAgdGhpcy51bFRvZG9MaXN0LnJlbW92ZUNoaWxkKGNoaWxkKTtcbiAgICAgIGNoaWxkID0gdGhpcy51bFRvZG9MaXN0LmZpcnN0Q2hpbGQ7XG4gICAgfVxuICAgIHRoaXMudWxUb2RvTGlzdC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gIH1cblxuICBjbGVhck5ld1RvRG9JbnB1dCgpIHtcbiAgICB0aGlzLmlucHV0TmV3VG9kby52YWx1ZSA9ICcnO1xuICB9XG5cbiAgbGlzdGVuVG9nZ2xlQWxsKGhhbmRsZXIpIHtcbiAgICBzZXRMaXN0ZW5lcih0aGlzLmJ1dHRvblRvZ2dsZUFsbCwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29tcGxldGVkID0gdGhpcy5idXR0b25Ub2dnbGVBbGwuY2hlY2tlZDtcbiAgICAgIGhhbmRsZXIoY29tcGxldGVkKTtcbiAgICB9KTtcbiAgfVxuXG4gIGxpc3Rlbk5ld1RvRG8oaGFuZGxlcikge1xuICAgIHNldExpc3RlbmVyKHRoaXMuaW5wdXROZXdUb2RvLCAnY2hhbmdlJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLmlucHV0TmV3VG9kby52YWx1ZS50cmltKCk7XG4gICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgdGhpcy5jbGVhck5ld1RvRG9JbnB1dCgpO1xuICAgICAgICBoYW5kbGVyKHRpdGxlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGxpc3RlblRvSXRlbUNoYW5nZShoYW5kbGVyKSB7XG4gICAgc2V0TGlzdGVuZXIodGhpcy51bFRvZG9MaXN0LCAnZGJsY2xpY2snLCAoeyB0YXJnZXQgfSkgPT4ge1xuICAgICAgaWYgKCFPYmplY3QuaXModGFyZ2V0LnRhZ05hbWUsICdMQUJFTCcpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbGkgPSB0YXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgICAgY29uc3QgZWRpdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICBlZGl0LmNsYXNzTGlzdC5hZGQoJ2VkaXQnKTtcbiAgICAgIGVkaXQudmFsdWUgPSB0YXJnZXQuaW5uZXJUZXh0O1xuICAgICAgbGkuYXBwZW5kQ2hpbGQoZWRpdCk7XG4gICAgICBsaS5jbGFzc0xpc3QuYWRkKCdlZGl0aW5nJyk7XG4gICAgICBlZGl0LmZvY3VzKCk7XG5cbiAgICAgIHNldExpc3RlbmVyKGVkaXQsICdibHVyJywgKCkgPT4ge1xuICAgICAgICBpZiAoIWVkaXQuZGF0YXNldC5jYW5jZWxsZWQpIHtcbiAgICAgICAgICBoYW5kbGVyKGVkaXQudmFsdWUsIGxpLmRhdGFzZXQuaWQpO1xuICAgICAgICB9XG4gICAgICAgIGxpLmNsYXNzTGlzdC5yZW1vdmUoJ2VkaXRpbmcnKTtcbiAgICAgICAgbGkucmVtb3ZlQ2hpbGQoZWRpdCk7XG4gICAgICB9KTtcblxuICAgICAgc2V0TGlzdGVuZXIoZWRpdCwgJ2tleWRvd24nLCAoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgICAgICBlZGl0LmRhdGFzZXQuY2FuY2VsbGVkID0gJ3RydWUnO1xuICAgICAgICAgIGVkaXQuYmx1cigpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgICBlZGl0LmJsdXIoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBsaXN0ZW5Ub0l0ZW1SZW1vdmUoaGFuZGxlcikge1xuICAgIHNldExpc3RlbmVyKHRoaXMudWxUb2RvTGlzdCwgJ2NsaWNrJywgKHsgdGFyZ2V0IH0pID0+IHtcbiAgICAgIGlmICghdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGVzdHJveScpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxpID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgIGhhbmRsZXIobGkuZGF0YXNldC5pZCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBsaXN0ZW5Ub1JlbW92ZUNvbXBsZXRlZChoYW5kbGVyKSB7XG4gICAgc2V0TGlzdGVuZXIodGhpcy5idXR0b25DbGVhckNvbXBsZXRlZCwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgaGFuZGxlcigpO1xuICAgIH0pO1xuICB9XG5cbiAgbGlzdGVuVG9JdGVtVG9nZ2xlKGhhbmRsZXIpIHtcbiAgICBzZXRMaXN0ZW5lcih0aGlzLnVsVG9kb0xpc3QsICdjbGljaycsICh7IHRhcmdldCB9KSA9PiB7XG4gICAgICBpZiAoIXRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3RvZ2dsZScpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxpID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgIGlmIChsaS5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbXBsZXRlZCcpKSB7XG4gICAgICAgIGxpLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbXBsZXRlZCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGkuY2xhc3NMaXN0LmFkZCgnY29tcGxldGVkJyk7XG4gICAgICB9XG4gICAgICBpZiAoaGFuZGxlcikge1xuICAgICAgICBoYW5kbGVyKGxpLmRhdGFzZXQuaWQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyTGlzdCh0b2Rvcykge1xuICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIHRvZG9zLmZvckVhY2goKHRvZG8pID0+IHtcbiAgICAgIGNvbnN0IGxpID0gdGhpcy50ZW1wbGF0ZXMuY29uc3RydWN0b3IubmV3SXRlbUxpKHRvZG8pO1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQobGkpO1xuICAgIH0pO1xuICAgIHRoaXMuc3dhcExpc3RDb250ZW50KGZyYWdtZW50KTtcbiAgfVxuXG4gIHVwZGF0ZUFjdGl2ZUl0ZW1zRmllbGQoYWN0aXZlSXRlbXMpIHtcbiAgICBjb25zdCBuZXdDb3VudGVyID0gdGhpcy50ZW1wbGF0ZXMuY29uc3RydWN0b3IubmV3VG9kb0NvdW50U3BhbihhY3RpdmVJdGVtcyk7XG4gICAgdGhpcy5jb3VudGVyLnBhcmVudEVsZW1lbnQucmVwbGFjZUNoaWxkKG5ld0NvdW50ZXIsIHRoaXMuY291bnRlcik7XG4gICAgdGhpcy5jb3VudGVyID0gbmV3Q291bnRlcjtcbiAgfVxufVxuIiwiaW1wb3J0IHsgcXMgfSBmcm9tICcuLi9oZWxwZXJzL2hlbHBlcnMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZW1wbGF0ZXMge1xuICBzdGF0aWMgbmV3SXRlbUxpKHRvZG8pIHtcbiAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgICBsaS5kYXRhc2V0LmlkID0gdG9kby5pZDtcbiAgICBsaS5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz1cInZpZXdcIj5cbiAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJ0b2dnbGVcIiB0eXBlPVwiY2hlY2tib3hcIj5cbiAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+JHt0b2RvLnRpdGxlfTwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImRlc3Ryb3lcIj48L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDtcblxuICAgIGlmICh0b2RvLmNvbXBsZXRlZCkge1xuICAgICAgbGkuY2xhc3NMaXN0LmFkZCgnY29tcGxldGVkJyk7XG4gICAgICBxcygnLnRvZ2dsZScsIGxpKS5jaGVja2VkID0gdHJ1ZTtcbiAgICB9XG5cblxuICAgIHJldHVybiBsaTtcbiAgfVxuXG4gIHN0YXRpYyBuZXdUb2RvQ291bnRTcGFuKGl0ZW1zQW1vdW50KSB7XG4gICAgY29uc3QgY291bnRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcblxuICAgIGNvdW50ZXIuY2xhc3NMaXN0LmFkZCgndG9kby1jb3VudCcpO1xuICAgIGNvdW50ZXIuaW5uZXJIVE1MID0gYDxzdHJvbmc+JHtpdGVtc0Ftb3VudH08L3N0cm9uZz4gaXRlbSR7aXRlbXNBbW91bnQgJSAxMCA9PT0gMSA/ICcnIDogJ3MnfSBsZWZ0YDtcblxuICAgIHJldHVybiBjb3VudGVyO1xuICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9