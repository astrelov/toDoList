!function(t){var e={};function o(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";function s(t,e){return(e||document).querySelector(t)}function i(t,e,o){t.addEventListener(e,o)}function n(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}o.r(e);const l=new class{constructor(t,e){this.model=t,this.view=e,this.view.listenToggleAll(this.toggleAll.bind(this)),this.view.listenNewToDo(this.newToDo.bind(this)),this.view.listenToItemChange(this.endEditItem.bind(this)),this.view.listenToItemRemove(this.removeItem.bind(this)),this.view.listenToItemToggle(this.toggleItem.bind(this)),this.view.listenToRemoveCompleted(this.removeCompleted.bind(this))}setView(t=document.location.hash){let e;switch(t.replace(/^#\//,"")){case"active":e=this.model.getIncompleted();break;case"completed":e=this.model.getCompleted();break;case"":e=this.model.todos}console.log(this.model.todos),this.view.setMainVisibility(this.model.todos.length),this.view.setFooterVisibility(this.model.todos.length),this.view.renderList(e),this.view.updateActiveItems(this.model.getIncompleted().length)}newToDo(t){this.model.addItem(t),this.setView()}endEditItem(t,e){this.model.setItemTitle(t,e),this.setView()}toggleAll(t){this.model.setAllCompletion(t),this.setView()}toggleItem(t){this.model.toggleItem(t),this.setView()}removeItem(t){this.model.removeItem(t),this.setView()}removeCompleted(){this.model.removeCompleted(),this.setView()}}(new class{constructor(t){this.todos=[],this.pushToStorage=(()=>{localStorage.setItem(t,JSON.stringify(this.todos))}),this.pullFromStorage=(()=>{this.todos=JSON.parse(localStorage.getItem(t)||"[]")}),this.pullFromStorage()}getCompleted(){return this.todos.filter(t=>t.completed)}getIncompleted(){return this.todos.filter(t=>!t.completed)}setAllCompletion(t){this.todos.forEach(e=>e.completed=t),this.pushToStorage()}allComplete(){return this.getCompleted().length===this.todos.length}allIncomplete(){return this.getIncompleted().length===this.todos.length}removeCompleted(){this.todos=this.getIncompleted(),this.pushToStorage()}addItem(t){if(t=t.trim()){const e={title:t,id:`${n()+n()}-${n()}-${n()}-${n()}-${n()}${n()}${n()}`,completed:!1};this.todos.push(e),this.pushToStorage()}}setItemTitle(t,e){t=t.trim();const o=this.todos.find(t=>Object.is(t.id,e));t?(o.title=t,this.pushToStorage()):this.removeItem(e)}removeItem(t){this.todos.forEach((e,o)=>{Object.is(e.id,t)&&this.todos.splice(o,1)}),this.pushToStorage()}toggleItem(t){this.todos.forEach(e=>{Object.is(e.id,t)&&(e.completed=!e.completed,this.pushToStorage())})}}("todo-astrielov"),new class{constructor(t){this.templates=t,this.sectionTodoapp=s(".todoapp"),this.sectionMain=s(".main",this.sectionTodoapp),this.inputNewTodo=s(".new-todo",this.sectionTodoapp),this.buttonToggleAll=s(".toggle-all",this.sectionTodoapp),this.buttonClearCompleted=s(".clear-completed",this.sectionTodoapp),this.ulTodoList=s(".todo-list",this.sectionTodoapp),this.counter=s(".todo-count",this.sectionTodoapp),this.footer=s(".footer",this.sectionTodoapp)}setMainVisibility(t){this.sectionMain.style.display=t?"block":"none"}setFooterVisibility(t){this.footer.style.display=t?"block":"none"}swapListContent(t){this.ulTodoList.innerHTML="",this.ulTodoList.appendChild(t)}clearNewToDoInput(){this.inputNewTodo.value=""}listenToggleAll(t){i(this.buttonToggleAll,"click",()=>{const e=this.buttonToggleAll.checked;t(e)})}listenNewToDo(t){i(this.inputNewTodo,"change",()=>{const e=this.inputNewTodo.value.trim();e&&(this.clearNewToDoInput(),t(e))})}listenToItemChange(t){i(this.ulTodoList,"dblclick",({target:e})=>{if(!Object.is(e.tagName,"LABEL"))return;const o=e.parentElement.parentElement,n=s(".edit",o)||document.createElement("input");n.classList.add("edit"),n.value=e.innerText,o.appendChild(n),o.classList.add("editing"),n.focus(),i(n,"change",()=>{t(n.value,o.dataset.id),o.classList.remove("editing")}),i(n,"blur",()=>{t(n.value,o.dataset.id),o.classList.remove("editing")})})}listenToItemRemove(t){i(this.ulTodoList,"click",({target:e})=>{if(!e.classList.contains("destroy"))return;const o=e.parentElement.parentElement;t&&t(o.dataset.id)})}listenToRemoveCompleted(t){i(this.buttonClearCompleted,"click",()=>{t()})}listenToItemToggle(t){i(this.ulTodoList,"click",({target:e})=>{if(!e.classList.contains("toggle"))return;const o=e.parentElement.parentElement;o.classList.contains("completed")?o.classList.remove("completed"):o.classList.add("completed"),t&&t(o.dataset.id)})}renderList(t){const e=document.createDocumentFragment();t.forEach(t=>{const o=document.createElement("li");o.innerHTML=this.templates.constructor.item(t.title),o.dataset.id=t.id,t.completed&&(o.classList.add("completed"),s(".toggle",o).checked=!0),e.appendChild(o)},""),this.swapListContent(e)}updateActiveItems(t){const e=this.templates.constructor.todoCount(t);this.counter.innerHTML=e}}(new class{static item(t,e){return`\n    <div class="view">\n      <input class="toggle" type="checkbox">\n      <label>${t}</label>\n      <button class="destroy"></button>\n    </div>\n    \x3c!--<input class="edit" value="${t}">--\x3e`}static todoCount(t){return`<strong>${t}</strong> item${1===t?"":"s"} left`}}));i(window,"load",()=>l.setView()),i(window,"hashchange",()=>l.setView()),i(window,"load",()=>{console.log(`DOCUMENT LOCATION HASH: ${document.location.hash}`)}),i(window,"hashchange",()=>{console.log(`DOCUMENT LOCATION HASH: ${document.location.hash}`)})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vanMvaGVscGVycy9oZWxwZXJzLmpzIiwid2VicGFjazovLy8uL2pzL2hlbHBlcnMvaWRHZW5lcmF0b3IuanMiLCJ3ZWJwYWNrOi8vLy4vanMvYXBwLmpzIiwid2VicGFjazovLy8uL2pzL2NvbnRyb2xsZXIvY29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly8vLi9qcy9tb2RlbC9zdG9yZU1vZGVsLmpzIiwid2VicGFjazovLy8uL2pzL3ZpZXcvdmlldy5qcyIsIndlYnBhY2s6Ly8vLi9qcy92aWV3L3RlbXBsYXRlcy5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJ2YWx1ZSIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwicXMiLCJzZWxlY3RvciIsInNjb3BlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2V0TGlzdGVuZXIiLCJ0YXJnZXQiLCJldmVudFR5cGUiLCJjYWxsYmFjayIsImFkZEV2ZW50TGlzdGVuZXIiLCJzNCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwiY29udHJvbGxlciIsIltvYmplY3QgT2JqZWN0XSIsIm1vZGVsIiwidmlldyIsInRoaXMiLCJsaXN0ZW5Ub2dnbGVBbGwiLCJ0b2dnbGVBbGwiLCJiaW5kIiwibGlzdGVuTmV3VG9EbyIsIm5ld1RvRG8iLCJsaXN0ZW5Ub0l0ZW1DaGFuZ2UiLCJlbmRFZGl0SXRlbSIsImxpc3RlblRvSXRlbVJlbW92ZSIsInJlbW92ZUl0ZW0iLCJsaXN0ZW5Ub0l0ZW1Ub2dnbGUiLCJ0b2dnbGVJdGVtIiwibGlzdGVuVG9SZW1vdmVDb21wbGV0ZWQiLCJyZW1vdmVDb21wbGV0ZWQiLCJyYXciLCJsb2NhdGlvbiIsImhhc2giLCJjdXJyZW50VG9kb3MiLCJyZXBsYWNlIiwiZ2V0SW5jb21wbGV0ZWQiLCJnZXRDb21wbGV0ZWQiLCJ0b2RvcyIsImNvbnNvbGUiLCJsb2ciLCJzZXRNYWluVmlzaWJpbGl0eSIsImxlbmd0aCIsInNldEZvb3RlclZpc2liaWxpdHkiLCJyZW5kZXJMaXN0IiwidXBkYXRlQWN0aXZlSXRlbXMiLCJ0aXRsZSIsImFkZEl0ZW0iLCJzZXRWaWV3IiwiaWQiLCJzZXRJdGVtVGl0bGUiLCJjb21wbGV0ZWQiLCJzZXRBbGxDb21wbGV0aW9uIiwic3RvcmFnZVZhck5hbWUiLCJwdXNoVG9TdG9yYWdlIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwdWxsRnJvbVN0b3JhZ2UiLCJwYXJzZSIsImdldEl0ZW0iLCJmaWx0ZXIiLCJ0b2RvIiwiZm9yRWFjaCIsInRyaW0iLCJpdGVtIiwicHVzaCIsImZpbmQiLCJpcyIsImluZGV4Iiwic3BsaWNlIiwidGVtcGxhdGVzIiwic2VjdGlvblRvZG9hcHAiLCJzZWN0aW9uTWFpbiIsImlucHV0TmV3VG9kbyIsImJ1dHRvblRvZ2dsZUFsbCIsImJ1dHRvbkNsZWFyQ29tcGxldGVkIiwidWxUb2RvTGlzdCIsImNvdW50ZXIiLCJmb290ZXIiLCJ2aXNpYmxlIiwic3R5bGUiLCJkaXNwbGF5IiwiZnJhZ21lbnQiLCJpbm5lckhUTUwiLCJhcHBlbmRDaGlsZCIsImhhbmRsZXIiLCJjaGVja2VkIiwiY2xlYXJOZXdUb0RvSW5wdXQiLCJ0YWdOYW1lIiwibGkiLCJwYXJlbnRFbGVtZW50IiwiZWRpdCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJpbm5lclRleHQiLCJmb2N1cyIsImRhdGFzZXQiLCJyZW1vdmUiLCJjb250YWlucyIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJjb25zdHJ1Y3RvciIsInN3YXBMaXN0Q29udGVudCIsImFjdGl2ZUl0ZW1zIiwiaHRtbFRvUGFzdGUiLCJ0b2RvQ291bnQiLCJpdGVtc0Ftb3VudCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQ0FLLGNBQUEsRUFDQUMsWUFBQSxFQUNBQyxJQUFBTixLQU1BWixFQUFBbUIsRUFBQSxTQUFBakIsR0FDQVksT0FBQUMsZUFBQWIsRUFBQSxjQUFpRGtCLE9BQUEsS0FJakRwQixFQUFBcUIsRUFBQSxTQUFBbEIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBbUIsV0FDQSxXQUEyQixPQUFBbkIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBSCxFQUFBVSxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFaLEVBQUFhLEVBQUEsU0FBQVUsRUFBQUMsR0FBc0QsT0FBQVYsT0FBQVcsVUFBQUMsZUFBQW5CLEtBQUFnQixFQUFBQyxJQUd0RHhCLEVBQUEyQixFQUFBLEdBSUEzQixJQUFBNEIsRUFBQSxrQ0NuRUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQSxPQUFBQSxHQUFBQyxVQUFBQyxjQUFBSCxHQUdBLFNBQUFJLEVBQUFD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LFVBQ0EsT0FFQSxNQUFBVixFQUFBeEYsRUFBQXlGLDRCQUNBRCxFQUFBSSxVQUFBTSxTQUFBLGFBQ0FWLEVBQUFJLFVBQUFLLE9BQUEsYUFFQVQsRUFBQUksVUFBQUMsSUFBQSxhQUVBVCxHQUNBQSxFQUFBSSxFQUFBUSxRQUFBbEQsTUFLQW5DLFdBQUF3QixHQUNBLE1BQUE4QyxFQUFBcEYsU0FBQXNHLHlCQUNBaEUsRUFBQTBCLFFBQUFELElBQ0EsTUFBQTRCLEVBQUEzRixTQUFBOEYsY0FBQSxNQUNBSCxFQUFBTixVQUFBcEUsS0FBQXVELFVBQUErQixZQUFBckMsS0FBQUgsRUFBQWpCLE9BQ0E2QyxFQUFBUSxRQUFBbEQsR0FBQWMsRUFBQWQsR0FDQWMsRUFBQVosWUFDQXdDLEVBQUFJLFVBQUFDLElBQUEsYUFDQW5HLEVBQUEsVUFBQThGLEdBQUFILFNBQUEsR0FFQUosRUFBQUUsWUFBQUssSUFDSyxJQUNMMUUsS0FBQXVGLGdCQUFBcEIsR0FHQXRFLGtCQUFBMkYsR0FDQSxNQUFBQyxFQUFBekYsS0FBQXVELFVBQUErQixZQUFBSSxVQUFBRixHQUNBeEYsS0FBQThELFFBQUFNLFVBQUFxQixJSHpIQSxVSU5BNUYsWUFBQWdDLEVBQUFLLEdBQ0EsOEZBR2VMLHlHQUdzQkEsWUFJckNoQyxpQkFBQThGLEdBQ0EsaUJBQXNCQSxrQkFBNEIsSUFBQUEsRUFBQSxrQkpEbEQxRyxFQUFBMkcsT0FBQSxXQUFBaEcsRUFBQW1DLFdBQ0E5QyxFQUFBMkcsT0FBQSxpQkFBQWhHLEVBQUFtQyxXQU9BOUMsRUFBQTJHLE9BQUEsWUFDQXRFLFFBQUFDLCtCQUF5Q3hDLFNBQUFnQyxTQUFBQyxVQUV6Qy9CLEVBQUEyRyxPQUFBLGtCQUNBdEUsUUFBQUMsK0JBQXlDeEMsU0FBQWdDLFNBQUFDIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJleHBvcnQgZnVuY3Rpb24gcXMoc2VsZWN0b3IsIHNjb3BlKSB7XG4gIHJldHVybiAoc2NvcGUgfHwgZG9jdW1lbnQpLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0TGlzdGVuZXIodGFyZ2V0LCBldmVudFR5cGUsIGNhbGxiYWNrKSB7XG4gIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgY2FsbGJhY2spO1xufVxuIiwiZnVuY3Rpb24gczQoKSB7XG4gIHJldHVybiBNYXRoLmZsb29yKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwKVxuICAgIC50b1N0cmluZygxNilcbiAgICAuc3Vic3RyaW5nKDEpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnZW5lclVuaXFJZCgpIHtcbiAgcmV0dXJuIGAke3M0KCkgKyBzNCgpfS0ke3M0KCl9LSR7czQoKX0tJHtzNCgpfS0ke3M0KCl9JHtzNCgpfSR7czQoKX1gO1xufVxuIiwiaW1wb3J0IHsgc2V0TGlzdGVuZXIgfSBmcm9tICcuL2hlbHBlcnMvaGVscGVycyc7XG5pbXBvcnQgU3RvcmVNb2RlbCBmcm9tICcuL21vZGVsL3N0b3JlTW9kZWwnO1xuaW1wb3J0IFRlbXBsYXRlcyBmcm9tICcuL3ZpZXcvdGVtcGxhdGVzJztcbmltcG9ydCBWaWV3IGZyb20gJy4vdmlldy92aWV3JztcbmltcG9ydCBDb250cm9sbGVyIGZyb20gJy4vY29udHJvbGxlci9jb250cm9sbGVyJztcblxuY29uc3QgbW9kZWwgPSBuZXcgU3RvcmVNb2RlbCgndG9kby1hc3RyaWVsb3YnKTtcblxuY29uc3QgdGVtcGxhdGVzID0gbmV3IFRlbXBsYXRlcygpO1xuY29uc3QgdmlldyA9IG5ldyBWaWV3KHRlbXBsYXRlcyk7XG5cbmNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQ29udHJvbGxlcihtb2RlbCwgdmlldyk7XG5cbnNldExpc3RlbmVyKHdpbmRvdywgJ2xvYWQnLCAoKSA9PiBjb250cm9sbGVyLnNldFZpZXcoKSk7XG5zZXRMaXN0ZW5lcih3aW5kb3csICdoYXNoY2hhbmdlJywgKCkgPT4gY29udHJvbGxlci5zZXRWaWV3KCkpO1xuXG5cblxuXG5cblxuc2V0TGlzdGVuZXIod2luZG93LCAnbG9hZCcsICgpID0+IHtcbiAgY29uc29sZS5sb2coYERPQ1VNRU5UIExPQ0FUSU9OIEhBU0g6ICR7ZG9jdW1lbnQubG9jYXRpb24uaGFzaH1gKTtcbn0pO1xuc2V0TGlzdGVuZXIod2luZG93LCAnaGFzaGNoYW5nZScsICgpID0+IHtcbiAgY29uc29sZS5sb2coYERPQ1VNRU5UIExPQ0FUSU9OIEhBU0g6ICR7ZG9jdW1lbnQubG9jYXRpb24uaGFzaH1gKTtcbn0pO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKG1vZGVsLCB2aWV3KSB7XG4gICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgIHRoaXMudmlldyA9IHZpZXc7XG5cbiAgICB0aGlzLnZpZXcubGlzdGVuVG9nZ2xlQWxsKHRoaXMudG9nZ2xlQWxsLmJpbmQodGhpcykpO1xuICAgIHRoaXMudmlldy5saXN0ZW5OZXdUb0RvKHRoaXMubmV3VG9Eby5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnZpZXcubGlzdGVuVG9JdGVtQ2hhbmdlKHRoaXMuZW5kRWRpdEl0ZW0uYmluZCh0aGlzKSk7XG4gICAgdGhpcy52aWV3Lmxpc3RlblRvSXRlbVJlbW92ZSh0aGlzLnJlbW92ZUl0ZW0uYmluZCh0aGlzKSk7XG4gICAgdGhpcy52aWV3Lmxpc3RlblRvSXRlbVRvZ2dsZSh0aGlzLnRvZ2dsZUl0ZW0uYmluZCh0aGlzKSk7XG4gICAgdGhpcy52aWV3Lmxpc3RlblRvUmVtb3ZlQ29tcGxldGVkKHRoaXMucmVtb3ZlQ29tcGxldGVkLmJpbmQodGhpcykpO1xuICB9XG5cbiAgc2V0VmlldyhyYXcgPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoKSB7XG4gICAgY29uc3Qgcm91dGUgPSByYXcucmVwbGFjZSgvXiNcXC8vLCAnJyk7XG4gICAgbGV0IGN1cnJlbnRUb2RvcztcbiAgICBzd2l0Y2ggKHJvdXRlKSB7XG4gICAgICBjYXNlICdhY3RpdmUnOlxuICAgICAgICBjdXJyZW50VG9kb3MgPSB0aGlzLm1vZGVsLmdldEluY29tcGxldGVkKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnY29tcGxldGVkJzpcbiAgICAgICAgY3VycmVudFRvZG9zID0gdGhpcy5tb2RlbC5nZXRDb21wbGV0ZWQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICcnOlxuICAgICAgICBjdXJyZW50VG9kb3MgPSB0aGlzLm1vZGVsLnRvZG9zO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyh0aGlzLm1vZGVsLnRvZG9zKTtcbiAgICB0aGlzLnZpZXcuc2V0TWFpblZpc2liaWxpdHkodGhpcy5tb2RlbC50b2Rvcy5sZW5ndGgpO1xuICAgIHRoaXMudmlldy5zZXRGb290ZXJWaXNpYmlsaXR5KHRoaXMubW9kZWwudG9kb3MubGVuZ3RoKTtcbiAgICB0aGlzLnZpZXcucmVuZGVyTGlzdChjdXJyZW50VG9kb3MpO1xuICAgIHRoaXMudmlldy51cGRhdGVBY3RpdmVJdGVtcyh0aGlzLm1vZGVsLmdldEluY29tcGxldGVkKCkubGVuZ3RoKTtcbiAgfVxuXG4gIG5ld1RvRG8odGl0bGUpIHtcbiAgICB0aGlzLm1vZGVsLmFkZEl0ZW0odGl0bGUpO1xuICAgIHRoaXMuc2V0VmlldygpO1xuICB9XG5cbiAgZW5kRWRpdEl0ZW0odGl0bGUsIGlkKSB7XG4gICAgdGhpcy5tb2RlbC5zZXRJdGVtVGl0bGUodGl0bGUsIGlkKTtcbiAgICB0aGlzLnNldFZpZXcoKTtcbiAgfVxuXG4gIHRvZ2dsZUFsbChjb21wbGV0ZWQpIHtcbiAgICB0aGlzLm1vZGVsLnNldEFsbENvbXBsZXRpb24oY29tcGxldGVkKTtcbiAgICB0aGlzLnNldFZpZXcoKTtcbiAgfVxuXG4gIHRvZ2dsZUl0ZW0oaWQpIHtcbiAgICB0aGlzLm1vZGVsLnRvZ2dsZUl0ZW0oaWQpO1xuICAgIHRoaXMuc2V0VmlldygpO1xuICB9XG5cbiAgcmVtb3ZlSXRlbShpZCkge1xuICAgIHRoaXMubW9kZWwucmVtb3ZlSXRlbShpZCk7XG4gICAgdGhpcy5zZXRWaWV3KCk7XG4gIH1cblxuICByZW1vdmVDb21wbGV0ZWQoKSB7XG4gICAgdGhpcy5tb2RlbC5yZW1vdmVDb21wbGV0ZWQoKTtcbiAgICB0aGlzLnNldFZpZXcoKTtcbiAgfVxufVxuIiwiaW1wb3J0IGdlbmVyVW5pcUlkIGZyb20gJy4uL2hlbHBlcnMvaWRHZW5lcmF0b3InO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdG9yZU1vZGVsIHtcbiAgY29uc3RydWN0b3Ioc3RvcmFnZVZhck5hbWUpIHtcbiAgICB0aGlzLnRvZG9zID0gW107XG5cbiAgICB0aGlzLnB1c2hUb1N0b3JhZ2UgPSAoKSA9PiB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yYWdlVmFyTmFtZSwgSlNPTi5zdHJpbmdpZnkodGhpcy50b2RvcykpO1xuICAgIH07XG5cbiAgICB0aGlzLnB1bGxGcm9tU3RvcmFnZSA9ICgpID0+IHtcbiAgICAgIHRoaXMudG9kb3MgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VWYXJOYW1lKSB8fCAnW10nKTtcbiAgICB9O1xuXG4gICAgdGhpcy5wdWxsRnJvbVN0b3JhZ2UoKTtcbiAgfVxuXG4gIGdldENvbXBsZXRlZCgpIHtcbiAgICByZXR1cm4gdGhpcy50b2Rvcy5maWx0ZXIodG9kbyA9PiB0b2RvLmNvbXBsZXRlZCk7XG4gIH1cblxuICBnZXRJbmNvbXBsZXRlZCgpIHtcbiAgICByZXR1cm4gdGhpcy50b2Rvcy5maWx0ZXIodG9kbyA9PiAhdG9kby5jb21wbGV0ZWQpO1xuICB9XG5cbiAgc2V0QWxsQ29tcGxldGlvbihjb21wbGV0ZWQpIHtcbiAgICB0aGlzLnRvZG9zLmZvckVhY2godG9kbyA9PiB0b2RvLmNvbXBsZXRlZCA9IGNvbXBsZXRlZCk7XG4gICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gIH1cblxuICBhbGxDb21wbGV0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRDb21wbGV0ZWQoKS5sZW5ndGggPT09IHRoaXMudG9kb3MubGVuZ3RoO1xuICB9XG5cbiAgYWxsSW5jb21wbGV0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRJbmNvbXBsZXRlZCgpLmxlbmd0aCA9PT0gdGhpcy50b2Rvcy5sZW5ndGg7XG4gIH1cblxuICByZW1vdmVDb21wbGV0ZWQoKSB7XG4gICAgdGhpcy50b2RvcyA9IHRoaXMuZ2V0SW5jb21wbGV0ZWQoKTtcbiAgICB0aGlzLnB1c2hUb1N0b3JhZ2UoKTtcbiAgfVxuXG4gIGFkZEl0ZW0odGl0bGUpIHtcbiAgICB0aXRsZSA9IHRpdGxlLnRyaW0oKTtcbiAgICBpZiAodGl0bGUpIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSB7XG4gICAgICAgIHRpdGxlLFxuICAgICAgICBpZDogZ2VuZXJVbmlxSWQoKSxcbiAgICAgICAgY29tcGxldGVkOiBmYWxzZSxcbiAgICAgIH07XG4gICAgICB0aGlzLnRvZG9zLnB1c2goaXRlbSk7XG4gICAgICB0aGlzLnB1c2hUb1N0b3JhZ2UoKTtcbiAgICB9XG4gIH1cblxuICBzZXRJdGVtVGl0bGUodGl0bGUsIGlkKSB7XG4gICAgdGl0bGUgPSB0aXRsZS50cmltKCk7XG4gICAgY29uc3QgdG9kbyA9IHRoaXMudG9kb3MuZmluZCh0b2RvID0+IE9iamVjdC5pcyh0b2RvLmlkLCBpZCkpO1xuICAgIGlmICh0aXRsZSkge1xuICAgICAgdG9kby50aXRsZSA9IHRpdGxlO1xuICAgICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVtb3ZlSXRlbShpZCk7XG4gICAgfVxuICB9XG5cbiAgcmVtb3ZlSXRlbShpZCkge1xuICAgIHRoaXMudG9kb3MuZm9yRWFjaCgodG9kbywgaW5kZXgpID0+IHtcbiAgICAgIGlmIChPYmplY3QuaXModG9kby5pZCwgaWQpKSB7XG4gICAgICAgIHRoaXMudG9kb3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLnB1c2hUb1N0b3JhZ2UoKTtcbiAgfVxuXG4gIHRvZ2dsZUl0ZW0oaWQpIHtcbiAgICB0aGlzLnRvZG9zLmZvckVhY2godG9kbyA9PiB7XG4gICAgICBpZiAoT2JqZWN0LmlzKHRvZG8uaWQsIGlkKSkge1xuICAgICAgICB0b2RvLmNvbXBsZXRlZCA9ICF0b2RvLmNvbXBsZXRlZDtcbiAgICAgICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gICAgICB9XG4gICAgfSlcbiAgfVxufVxuIiwiLyogZXNsaW50LWRpc2FibGUgbm8tZXh0cmEtYm9vbGVhbi1jYXN0ICovXG5pbXBvcnQge3FzLCBzZXRMaXN0ZW5lcn0gZnJvbSAnLi4vaGVscGVycy9oZWxwZXJzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmlldyB7XG4gIGNvbnN0cnVjdG9yKHRlbXBsYXRlcykge1xuICAgIHRoaXMudGVtcGxhdGVzID0gdGVtcGxhdGVzO1xuICAgIHRoaXMuc2VjdGlvblRvZG9hcHAgPSBxcygnLnRvZG9hcHAnKTtcbiAgICB0aGlzLnNlY3Rpb25NYWluID0gcXMoJy5tYWluJywgdGhpcy5zZWN0aW9uVG9kb2FwcCk7XG4gICAgdGhpcy5pbnB1dE5ld1RvZG8gPSBxcygnLm5ldy10b2RvJywgdGhpcy5zZWN0aW9uVG9kb2FwcCk7XG4gICAgdGhpcy5idXR0b25Ub2dnbGVBbGwgPSBxcygnLnRvZ2dsZS1hbGwnLCB0aGlzLnNlY3Rpb25Ub2RvYXBwKTtcbiAgICB0aGlzLmJ1dHRvbkNsZWFyQ29tcGxldGVkID0gcXMoJy5jbGVhci1jb21wbGV0ZWQnLCB0aGlzLnNlY3Rpb25Ub2RvYXBwKTtcbiAgICB0aGlzLnVsVG9kb0xpc3QgPSBxcygnLnRvZG8tbGlzdCcsIHRoaXMuc2VjdGlvblRvZG9hcHApO1xuICAgIHRoaXMuY291bnRlciA9IHFzKCcudG9kby1jb3VudCcsIHRoaXMuc2VjdGlvblRvZG9hcHApO1xuICAgIHRoaXMuZm9vdGVyID0gcXMoJy5mb290ZXInLCB0aGlzLnNlY3Rpb25Ub2RvYXBwKTtcbiAgfVxuXG4gIHNldE1haW5WaXNpYmlsaXR5KHZpc2libGUpIHtcbiAgICB0aGlzLnNlY3Rpb25NYWluLnN0eWxlLmRpc3BsYXkgPSAhIXZpc2libGUgPyAnYmxvY2snIDogJ25vbmUnO1xuICB9XG5cbiAgc2V0Rm9vdGVyVmlzaWJpbGl0eSh2aXNpYmxlKSB7XG4gICAgdGhpcy5mb290ZXIuc3R5bGUuZGlzcGxheSA9ICEhdmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZSc7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIGZyYWdtZW50XG4gICAqL1xuICBzd2FwTGlzdENvbnRlbnQoZnJhZ21lbnQpIHtcbiAgICB0aGlzLnVsVG9kb0xpc3QuaW5uZXJIVE1MID0gJyc7XG4gICAgdGhpcy51bFRvZG9MaXN0LmFwcGVuZENoaWxkKGZyYWdtZW50KTtcbiAgfVxuXG4gIGNsZWFyTmV3VG9Eb0lucHV0KCkge1xuICAgIHRoaXMuaW5wdXROZXdUb2RvLnZhbHVlID0gJyc7XG4gIH1cblxuICBsaXN0ZW5Ub2dnbGVBbGwoaGFuZGxlcikge1xuICAgIHNldExpc3RlbmVyKHRoaXMuYnV0dG9uVG9nZ2xlQWxsLCAnY2xpY2snLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wbGV0ZWQgPSB0aGlzLmJ1dHRvblRvZ2dsZUFsbC5jaGVja2VkO1xuICAgICAgaGFuZGxlcihjb21wbGV0ZWQpO1xuICAgIH0pXG4gIH1cblxuICBsaXN0ZW5OZXdUb0RvKGhhbmRsZXIpIHtcbiAgICBzZXRMaXN0ZW5lcih0aGlzLmlucHV0TmV3VG9kbywgJ2NoYW5nZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy5pbnB1dE5ld1RvZG8udmFsdWUudHJpbSgpO1xuICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgIHRoaXMuY2xlYXJOZXdUb0RvSW5wdXQoKTtcbiAgICAgICAgaGFuZGxlcih0aXRsZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBsaXN0ZW5Ub0l0ZW1DaGFuZ2UoaGFuZGxlcikge1xuICAgIHNldExpc3RlbmVyKHRoaXMudWxUb2RvTGlzdCwgJ2RibGNsaWNrJywgKHsgdGFyZ2V0IH0pID0+IHtcbiAgICAgIGlmICghT2JqZWN0LmlzKHRhcmdldC50YWdOYW1lLCAnTEFCRUwnKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBsaSA9IHRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgICBjb25zdCBlZGl0ID0gcXMoJy5lZGl0JywgbGkpIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICBlZGl0LmNsYXNzTGlzdC5hZGQoJ2VkaXQnKTtcbiAgICAgIGVkaXQudmFsdWUgPSB0YXJnZXQuaW5uZXJUZXh0O1xuICAgICAgbGkuYXBwZW5kQ2hpbGQoZWRpdCk7XG4gICAgICBsaS5jbGFzc0xpc3QuYWRkKCdlZGl0aW5nJyk7XG4gICAgICBlZGl0LmZvY3VzKCk7XG5cbiAgICAgIHNldExpc3RlbmVyKGVkaXQsICdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgIGhhbmRsZXIoZWRpdC52YWx1ZSwgbGkuZGF0YXNldC5pZCk7XG4gICAgICAgIGxpLmNsYXNzTGlzdC5yZW1vdmUoJ2VkaXRpbmcnKTtcbiAgICAgIH0pO1xuICAgICAgc2V0TGlzdGVuZXIoZWRpdCwgJ2JsdXInLCAoKSA9PiB7XG4gICAgICAgIGhhbmRsZXIoZWRpdC52YWx1ZSwgbGkuZGF0YXNldC5pZCk7XG4gICAgICAgIGxpLmNsYXNzTGlzdC5yZW1vdmUoJ2VkaXRpbmcnKTtcbiAgICAgIH0pO1xuICAgIH0pXG4gIH1cblxuICBsaXN0ZW5Ub0l0ZW1SZW1vdmUoaGFuZGxlcikge1xuICAgIHNldExpc3RlbmVyKHRoaXMudWxUb2RvTGlzdCwgJ2NsaWNrJywgKHsgdGFyZ2V0IH0pID0+IHtcbiAgICAgIGlmICghdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGVzdHJveScpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxpID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgIGhhbmRsZXIobGkuZGF0YXNldC5pZCk7XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGxpc3RlblRvUmVtb3ZlQ29tcGxldGVkKGhhbmRsZXIpIHtcbiAgICBzZXRMaXN0ZW5lcih0aGlzLmJ1dHRvbkNsZWFyQ29tcGxldGVkLCAnY2xpY2snLCAoKSA9PiB7XG4gICAgICBoYW5kbGVyKCk7XG4gICAgfSlcbiAgfVxuXG4gIGxpc3RlblRvSXRlbVRvZ2dsZShoYW5kbGVyKSB7XG4gICAgc2V0TGlzdGVuZXIodGhpcy51bFRvZG9MaXN0LCAnY2xpY2snLCAoeyB0YXJnZXQgfSkgPT4ge1xuICAgICAgaWYgKCF0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0b2dnbGUnKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBsaSA9IHRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgICBpZiAobGkuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wbGV0ZWQnKSkge1xuICAgICAgICBsaS5jbGFzc0xpc3QucmVtb3ZlKCdjb21wbGV0ZWQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpLmNsYXNzTGlzdC5hZGQoJ2NvbXBsZXRlZCcpO1xuICAgICAgfVxuICAgICAgaWYgKGhhbmRsZXIpIHtcbiAgICAgICAgaGFuZGxlcihsaS5kYXRhc2V0LmlkKTtcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgcmVuZGVyTGlzdCh0b2Rvcykge1xuICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIHRvZG9zLmZvckVhY2goKHRvZG8pID0+IHtcbiAgICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgICAgIGxpLmlubmVySFRNTCA9IHRoaXMudGVtcGxhdGVzLmNvbnN0cnVjdG9yLml0ZW0odG9kby50aXRsZSk7XG4gICAgICBsaS5kYXRhc2V0LmlkID0gdG9kby5pZDtcbiAgICAgIGlmICh0b2RvLmNvbXBsZXRlZCkge1xuICAgICAgICBsaS5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTtcbiAgICAgICAgcXMoJy50b2dnbGUnLCBsaSkuY2hlY2tlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChsaSk7XG4gICAgfSwgJycpO1xuICAgIHRoaXMuc3dhcExpc3RDb250ZW50KGZyYWdtZW50KTtcbiAgfVxuXG4gIHVwZGF0ZUFjdGl2ZUl0ZW1zKGFjdGl2ZUl0ZW1zKSB7XG4gICAgY29uc3QgaHRtbFRvUGFzdGUgPSB0aGlzLnRlbXBsYXRlcy5jb25zdHJ1Y3Rvci50b2RvQ291bnQoYWN0aXZlSXRlbXMpO1xuICAgIHRoaXMuY291bnRlci5pbm5lckhUTUwgPSBodG1sVG9QYXN0ZTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGVtcGxhdGVzIHtcblxuICBzdGF0aWMgaXRlbSh0aXRsZSwgY29tcGxldGVkKSB7XG4gICAgcmV0dXJuIGBcbiAgICA8ZGl2IGNsYXNzPVwidmlld1wiPlxuICAgICAgPGlucHV0IGNsYXNzPVwidG9nZ2xlXCIgdHlwZT1cImNoZWNrYm94XCI+XG4gICAgICA8bGFiZWw+JHt0aXRsZX08L2xhYmVsPlxuICAgICAgPGJ1dHRvbiBjbGFzcz1cImRlc3Ryb3lcIj48L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgICA8IS0tPGlucHV0IGNsYXNzPVwiZWRpdFwiIHZhbHVlPVwiJHt0aXRsZX1cIj4tLT5gXG4gICAgICA7XG4gIH1cblxuICBzdGF0aWMgdG9kb0NvdW50KGl0ZW1zQW1vdW50KSB7XG4gICAgcmV0dXJuIGA8c3Ryb25nPiR7aXRlbXNBbW91bnR9PC9zdHJvbmc+IGl0ZW0ke2l0ZW1zQW1vdW50ID09PSAxID8gJyc6ICdzJ30gbGVmdGA7XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=