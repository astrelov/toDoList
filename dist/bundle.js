!function(t){var e={};function o(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";function s(t,e){return(e||document).querySelector(t)}function i(t,e,o){t.addEventListener(e,o)}function l(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}o.r(e);const n=new class{constructor(t,e){this.model=t,this.view=e,this.view.listenToggleAll(this.toggleAll.bind(this)),this.view.listenNewToDo(this.newToDo.bind(this)),this.view.listenToItemChange(this.endEditItem.bind(this)),this.view.listenToItemRemove(this.removeItem.bind(this)),this.view.listenToItemToggle(this.toggleItem.bind(this)),this.view.listenToRemoveCompleted(this.removeCompleted.bind(this))}setView(t=document.location.hash){const e=t.replace(/^#\//,"");let o;switch(e){case"active":o=this.model.getIncompleted();break;case"completed":o=this.model.getCompleted();break;default:o=this.model.todos}this.view.setToggleAllState(this.model.allComplete()),this.view.setChosenFilter(e),this.view.setMainVisibility(this.model.todos.length),this.view.setFooterVisibility(this.model.todos.length),this.view.setClearButtVisibility(this.model.getCompleted().length),this.view.renderList(o),this.view.updateActiveItemsField(this.model.getIncompleted().length)}newToDo(t){this.model.addItem(t),this.setView()}endEditItem(t,e){this.model.setItemTitle(t,e),this.setView()}toggleAll(t){this.model.setAllCompletion(t),this.setView()}toggleItem(t){this.model.toggleItem(t),this.setView()}removeItem(t){this.model.removeItem(t),this.setView()}removeCompleted(){this.model.removeCompleted(),this.setView()}}(new class{constructor(t){this.todos=[],this.pushToStorage=(()=>{localStorage.setItem(t,JSON.stringify(this.todos))}),this.pullFromStorage=(()=>{this.todos=JSON.parse(localStorage.getItem(t)||"[]")}),this.pullFromStorage()}getCompleted(){return this.todos.filter(t=>t.completed)}getIncompleted(){return this.todos.filter(t=>!t.completed)}setAllCompletion(t){this.todos.forEach(e=>{e.completed=!!t}),this.pushToStorage()}allComplete(){return this.getCompleted().length===this.todos.length}removeCompleted(){this.todos=this.getIncompleted(),this.pushToStorage()}addItem(t){if(t=t.trim()){const e={title:t,id:`${l()+l()}-${l()}-${l()}-${l()}-${l()}${l()}${l()}`,completed:!1};this.todos.push(e),this.pushToStorage()}}setItemTitle(t,e){t=t.trim();const o=this.todos.find(t=>Object.is(t.id,e));t?(o.title=t,this.pushToStorage()):this.removeItem(e)}removeItem(t){this.todos.forEach((e,o)=>{Object.is(e.id,t)&&this.todos.splice(o,1)}),this.pushToStorage()}toggleItem(t){this.todos.forEach(e=>{Object.is(e.id,t)&&(e.completed=!e.completed,this.pushToStorage())})}}("todo-astrielov"),new class{constructor(t){this.templates=t,this.sectionTodoapp=s(".todoapp"),this.sectionMain=s(".main",this.sectionTodoapp),this.inputNewTodo=s(".new-todo",this.sectionTodoapp),this.buttonToggleAll=s(".toggle-all",this.sectionTodoapp),this.buttonClearCompleted=s(".clear-completed",this.sectionTodoapp),this.ulTodoList=s(".todo-list",this.sectionTodoapp),this.counter=s(".todo-count",this.sectionTodoapp),this.footer=s(".footer",this.sectionTodoapp),this.filters=s(".filters",this.sectionTodoapp)}setMainVisibility(t){this.sectionMain.style.display=t?"block":"none"}setFooterVisibility(t){this.footer.style.display=t?"block":"none"}setClearButtVisibility(t){this.buttonClearCompleted.style.display=t?"block":"none"}setToggleAllState(t){this.buttonToggleAll.checked=t}setChosenFilter(t){let e;switch(this.filters.querySelectorAll("a").forEach(t=>t.classList.remove("selected")),t){case"active":e=s("#showActive",this.filters);break;case"completed":e=s("#showCompleted",this.filters);break;default:e=s("#showAll",this.filters)}e.classList.add("selected")}setListContent(t){let e=this.ulTodoList.firstChild;for(;e;)this.ulTodoList.removeChild(e),e=this.ulTodoList.firstChild;this.ulTodoList.appendChild(t)}clearNewToDoInput(){this.inputNewTodo.value=""}listenToggleAll(t){i(this.buttonToggleAll,"click",()=>{const e=this.buttonToggleAll.checked;t(e)})}listenNewToDo(t){i(this.inputNewTodo,"change",()=>{const e=this.inputNewTodo.value.trim();e&&(this.clearNewToDoInput(),t(e))})}listenToItemChange(t){i(this.ulTodoList,"dblclick",({target:e})=>{if(!Object.is(e.tagName,"LABEL"))return;const o=e.parentElement.parentElement,s=document.createElement("input");s.classList.add("edit"),s.value=e.innerText,o.appendChild(s),o.classList.add("editing"),s.focus(),i(s,"blur",()=>{s.dataset.cancelled||t(s.value,o.dataset.id),o.classList.remove("editing"),o.removeChild(s)}),i(s,"keydown",t=>{"Escape"===t.key&&(s.dataset.cancelled="true",s.blur()),"Enter"===t.key&&s.blur()})})}listenToItemRemove(t){i(this.ulTodoList,"click",({target:e})=>{if(!e.classList.contains("destroy"))return;const o=e.parentElement.parentElement;t&&t(o.dataset.id)})}listenToRemoveCompleted(t){i(this.buttonClearCompleted,"click",()=>{t()})}listenToItemToggle(t){i(this.ulTodoList,"click",({target:e})=>{if(!e.classList.contains("toggle"))return;const o=e.parentElement.parentElement;o.classList.contains("completed")?o.classList.remove("completed"):o.classList.add("completed"),t&&t(o.dataset.id)})}renderList(t){const e=document.createDocumentFragment();t.forEach(t=>{const o=this.templates.constructor.newItemLi(t);e.appendChild(o)}),this.setListContent(e)}updateActiveItemsField(t){const e=this.templates.constructor.newTodoCountSpan(t);this.counter.parentElement.replaceChild(e,this.counter),this.counter=e}}(new class{static newItemLi(t){const e=document.createElement("li");return e.dataset.id=t.id,e.innerHTML=`<div class="view">\n                      <input class="toggle" type="checkbox">\n                      <label>${t.title}</label>\n                      <button class="destroy"></button>\n                    </div>`,t.completed&&(e.classList.add("completed"),s(".toggle",e).checked=!0),e}static newTodoCountSpan(t){const e=document.createElement("span"),o=t%10==1?"":"s";return e.classList.add("todo-count"),e.innerHTML=`<strong>${t}</strong> item${o} left`,e}}));i(window,"load",()=>n.setView()),i(window,"hashchange",()=>n.setView())}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vanMvaGVscGVycy9oZWxwZXJzLmpzIiwid2VicGFjazovLy8uL2pzL2hlbHBlcnMvaWRfZ2VuZXJhdG9yLmpzIiwid2VicGFjazovLy8uL2pzL2FwcC5qcyIsIndlYnBhY2s6Ly8vLi9qcy9jb250cm9sbGVyL2NvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vLy4vanMvbW9kZWwvc3RvcmVfbW9kZWwuanMiLCJ3ZWJwYWNrOi8vLy4vanMvdmlldy92aWV3LmpzIiwid2VicGFjazovLy8uL2pzL3ZpZXcvdGVtcGxhdGVzLmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJxcyIsInNlbGVjdG9yIiwic2NvcGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZXRMaXN0ZW5lciIsInRhcmdldCIsImV2ZW50VHlwZSIsImNhbGxiYWNrIiwiYWRkRXZlbnRMaXN0ZW5lciIsInM0IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHJpbmciLCJjb250cm9sbGVyIiwiW29iamVjdCBPYmplY3RdIiwibW9kZWwiLCJ2aWV3IiwidGhpcyIsImxpc3RlblRvZ2dsZUFsbCIsInRvZ2dsZUFsbCIsImJpbmQiLCJsaXN0ZW5OZXdUb0RvIiwibmV3VG9EbyIsImxpc3RlblRvSXRlbUNoYW5nZSIsImVuZEVkaXRJdGVtIiwibGlzdGVuVG9JdGVtUmVtb3ZlIiwicmVtb3ZlSXRlbSIsImxpc3RlblRvSXRlbVRvZ2dsZSIsInRvZ2dsZUl0ZW0iLCJsaXN0ZW5Ub1JlbW92ZUNvbXBsZXRlZCIsInJlbW92ZUNvbXBsZXRlZCIsInJhdyIsImxvY2F0aW9uIiwiaGFzaCIsInJvdXRlIiwicmVwbGFjZSIsImN1cnJlbnRUb2RvcyIsImdldEluY29tcGxldGVkIiwiZ2V0Q29tcGxldGVkIiwidG9kb3MiLCJzZXRUb2dnbGVBbGxTdGF0ZSIsImFsbENvbXBsZXRlIiwic2V0Q2hvc2VuRmlsdGVyIiwic2V0TWFpblZpc2liaWxpdHkiLCJsZW5ndGgiLCJzZXRGb290ZXJWaXNpYmlsaXR5Iiwic2V0Q2xlYXJCdXR0VmlzaWJpbGl0eSIsInJlbmRlckxpc3QiLCJ1cGRhdGVBY3RpdmVJdGVtc0ZpZWxkIiwidGl0bGUiLCJhZGRJdGVtIiwic2V0VmlldyIsImlkIiwic2V0SXRlbVRpdGxlIiwiY29tcGxldGVkIiwic2V0QWxsQ29tcGxldGlvbiIsInN0b3JhZ2VWYXJOYW1lIiwicHVzaFRvU3RvcmFnZSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwicHVsbEZyb21TdG9yYWdlIiwicGFyc2UiLCJnZXRJdGVtIiwiZmlsdGVyIiwidG9kbyIsImZvckVhY2giLCJpdGVtIiwidHJpbSIsInB1c2giLCJmaW5kIiwiaXMiLCJpbmRleCIsInNwbGljZSIsInRlbXBsYXRlcyIsInNlY3Rpb25Ub2RvYXBwIiwic2VjdGlvbk1haW4iLCJpbnB1dE5ld1RvZG8iLCJidXR0b25Ub2dnbGVBbGwiLCJidXR0b25DbGVhckNvbXBsZXRlZCIsInVsVG9kb0xpc3QiLCJjb3VudGVyIiwiZm9vdGVyIiwiZmlsdGVycyIsInZpc2libGUiLCJzdHlsZSIsImRpc3BsYXkiLCJjaGVja2VkIiwiY3VyckJ1dHQiLCJxdWVyeVNlbGVjdG9yQWxsIiwibm9kZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsImZyYWdtZW50IiwiY2hpbGQiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJhcHBlbmRDaGlsZCIsImhhbmRsZXIiLCJjbGVhck5ld1RvRG9JbnB1dCIsInRhZ05hbWUiLCJsaSIsInBhcmVudEVsZW1lbnQiLCJlZGl0IiwiY3JlYXRlRWxlbWVudCIsImlubmVyVGV4dCIsImZvY3VzIiwiZGF0YXNldCIsImNhbmNlbGxlZCIsImV2ZW50Iiwia2V5IiwiYmx1ciIsImNvbnRhaW5zIiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImNvbnN0cnVjdG9yIiwibmV3SXRlbUxpIiwic2V0TGlzdENvbnRlbnQiLCJhY3RpdmVJdGVtcyIsIm5ld0NvdW50ZXIiLCJuZXdUb2RvQ291bnRTcGFuIiwicmVwbGFjZUNoaWxkIiwiaW5uZXJIVE1MIiwiaXRlbXNBbW91bnQiLCJzdWZmaXgiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEtBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsSUFDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxZQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxHQUNBSyxjQUFBLEVBQ0FDLFlBQUEsRUFDQUMsSUFBQU4sS0FNQVosRUFBQW1CLEVBQUEsU0FBQWpCLEdBQ0FZLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURrQixPQUFBLEtBSWpEcEIsRUFBQXFCLEVBQUEsU0FBQWxCLEdBQ0EsSUFBQVMsRUFBQVQsS0FBQW1CLFdBQ0EsV0FBMkIsT0FBQW5CLEVBQUEsU0FDM0IsV0FB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QUFBRyxFQUFBTSxRQUFBekQsTUFLQXRDLFdBQUF5QixHQUNBLE1BQUF3RCxFQUFBL0YsU0FBQW1ILHlCQUNBNUUsRUFBQTRCLFFBQUFELElBQ0EsTUFBQXFDLEVBQUF0RixLQUFBMEQsVUFBQXlDLFlBQUFDLFVBQUFuRCxHQUNBNkIsRUFBQUksWUFBQUksS0FFQXRGLEtBQUFxRyxlQUFBdkIsR0FHQWpGLHVCQUFBeUcsR0FDQSxNQUFBQyxFQUFBdkcsS0FBQTBELFVBQUF5QyxZQUFBSyxpQkFBQUYsR0FDQXRHLEtBQUFpRSxRQUFBc0IsY0FBQWtCLGFBQUFGLEVBQUF2RyxLQUFBaUUsU0FDQWpFLEtBQUFpRSxRQUFBc0MsSUgzSkEsVUlMQTFHLGlCQUFBb0QsR0FDQSxNQUFBcUMsRUFBQXZHLFNBQUEwRyxjQUFBLE1BY0EsT0FaQUgsRUFBQU0sUUFBQXpELEdBQUFjLEVBQUFkLEdBQ0FtRCxFQUFBb0IsNEhBRStCekQsRUFBQWpCLHFHQUkvQmlCLEVBQUFaLFlBQ0FpRCxFQUFBWCxVQUFBRSxJQUFBLGFBQ0FqRyxFQUFBLFVBQUEwRyxHQUFBZixTQUFBLEdBR0FlLEVBR0F6Rix3QkFBQThHLEdBQ0EsTUFBQTFDLEVBQUFsRixTQUFBMEcsY0FBQSxRQUNBbUIsRUFBQUQsRUFBQSxhQUtBLE9BSEExQyxFQUFBVSxVQUFBRSxJQUFBLGNBQ0FaLEVBQUF5QyxxQkFBbUNDLGtCQUE0QkMsU0FFL0QzQyxNSmZBaEYsRUFBQTRILE9BQUEsV0FBQWpILEVBQUFzQyxXQUNBakQsRUFBQTRILE9BQUEsaUJBQUFqSCxFQUFBc0MiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImV4cG9ydCBmdW5jdGlvbiBxcyhzZWxlY3Rvciwgc2NvcGUpIHtcbiAgcmV0dXJuIChzY29wZSB8fCBkb2N1bWVudCkucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRMaXN0ZW5lcih0YXJnZXQsIGV2ZW50VHlwZSwgY2FsbGJhY2spIHtcbiAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBjYWxsYmFjayk7XG59XG4iLCJmdW5jdGlvbiBzNCgpIHtcbiAgcmV0dXJuIE1hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApXG4gICAgLnRvU3RyaW5nKDE2KVxuICAgIC5zdWJzdHJpbmcoMSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lclVuaXFJZCgpIHtcbiAgcmV0dXJuIGAke3M0KCkgKyBzNCgpfS0ke3M0KCl9LSR7czQoKX0tJHtzNCgpfS0ke3M0KCl9JHtzNCgpfSR7czQoKX1gO1xufVxuIiwiaW1wb3J0IHsgc2V0TGlzdGVuZXIgfSBmcm9tICcuL2hlbHBlcnMvaGVscGVycyc7XG5pbXBvcnQgU3RvcmVNb2RlbCBmcm9tICcuL21vZGVsL3N0b3JlX21vZGVsJztcbmltcG9ydCBUZW1wbGF0ZXMgZnJvbSAnLi92aWV3L3RlbXBsYXRlcyc7XG5pbXBvcnQgVmlldyBmcm9tICcuL3ZpZXcvdmlldyc7XG5pbXBvcnQgQ29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXIvY29udHJvbGxlcic7XG5cbmNvbnN0IG1vZGVsID0gbmV3IFN0b3JlTW9kZWwoJ3RvZG8tYXN0cmllbG92Jyk7XG5cbmNvbnN0IHRlbXBsYXRlcyA9IG5ldyBUZW1wbGF0ZXMoKTtcbmNvbnN0IHZpZXcgPSBuZXcgVmlldyh0ZW1wbGF0ZXMpO1xuXG5jb25zdCBjb250cm9sbGVyID0gbmV3IENvbnRyb2xsZXIobW9kZWwsIHZpZXcpO1xuXG5zZXRMaXN0ZW5lcih3aW5kb3csICdsb2FkJywgKCkgPT4gY29udHJvbGxlci5zZXRWaWV3KCkpO1xuc2V0TGlzdGVuZXIod2luZG93LCAnaGFzaGNoYW5nZScsICgpID0+IGNvbnRyb2xsZXIuc2V0VmlldygpKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihtb2RlbCwgdmlldykge1xuICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcbiAgICB0aGlzLnZpZXcgPSB2aWV3O1xuXG4gICAgdGhpcy52aWV3Lmxpc3RlblRvZ2dsZUFsbCh0aGlzLnRvZ2dsZUFsbC5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLnZpZXcubGlzdGVuTmV3VG9Ebyh0aGlzLm5ld1RvRG8uYmluZCh0aGlzKSk7XG4gICAgdGhpcy52aWV3Lmxpc3RlblRvSXRlbUNoYW5nZSh0aGlzLmVuZEVkaXRJdGVtLmJpbmQodGhpcykpO1xuICAgIHRoaXMudmlldy5saXN0ZW5Ub0l0ZW1SZW1vdmUodGhpcy5yZW1vdmVJdGVtLmJpbmQodGhpcykpO1xuICAgIHRoaXMudmlldy5saXN0ZW5Ub0l0ZW1Ub2dnbGUodGhpcy50b2dnbGVJdGVtLmJpbmQodGhpcykpO1xuICAgIHRoaXMudmlldy5saXN0ZW5Ub1JlbW92ZUNvbXBsZXRlZCh0aGlzLnJlbW92ZUNvbXBsZXRlZC5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHNldFZpZXcocmF3ID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaCkge1xuICAgIGNvbnN0IHJvdXRlID0gcmF3LnJlcGxhY2UoL14jXFwvLywgJycpO1xuICAgIGxldCBjdXJyZW50VG9kb3M7XG4gICAgc3dpdGNoIChyb3V0ZSkge1xuICAgICAgY2FzZSAnYWN0aXZlJzpcbiAgICAgICAgY3VycmVudFRvZG9zID0gdGhpcy5tb2RlbC5nZXRJbmNvbXBsZXRlZCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2NvbXBsZXRlZCc6XG4gICAgICAgIGN1cnJlbnRUb2RvcyA9IHRoaXMubW9kZWwuZ2V0Q29tcGxldGVkKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY3VycmVudFRvZG9zID0gdGhpcy5tb2RlbC50b2RvcztcbiAgICB9XG4gICAgdGhpcy52aWV3LnNldFRvZ2dsZUFsbFN0YXRlKHRoaXMubW9kZWwuYWxsQ29tcGxldGUoKSk7XG4gICAgdGhpcy52aWV3LnNldENob3NlbkZpbHRlcihyb3V0ZSk7XG4gICAgdGhpcy52aWV3LnNldE1haW5WaXNpYmlsaXR5KHRoaXMubW9kZWwudG9kb3MubGVuZ3RoKTtcbiAgICB0aGlzLnZpZXcuc2V0Rm9vdGVyVmlzaWJpbGl0eSh0aGlzLm1vZGVsLnRvZG9zLmxlbmd0aCk7XG4gICAgdGhpcy52aWV3LnNldENsZWFyQnV0dFZpc2liaWxpdHkodGhpcy5tb2RlbC5nZXRDb21wbGV0ZWQoKS5sZW5ndGgpO1xuICAgIHRoaXMudmlldy5yZW5kZXJMaXN0KGN1cnJlbnRUb2Rvcyk7XG4gICAgdGhpcy52aWV3LnVwZGF0ZUFjdGl2ZUl0ZW1zRmllbGQodGhpcy5tb2RlbC5nZXRJbmNvbXBsZXRlZCgpLmxlbmd0aCk7XG4gIH1cblxuICBuZXdUb0RvKHRpdGxlKSB7XG4gICAgdGhpcy5tb2RlbC5hZGRJdGVtKHRpdGxlKTtcbiAgICB0aGlzLnNldFZpZXcoKTtcbiAgfVxuXG4gIGVuZEVkaXRJdGVtKHRpdGxlLCBpZCkge1xuICAgIHRoaXMubW9kZWwuc2V0SXRlbVRpdGxlKHRpdGxlLCBpZCk7XG4gICAgdGhpcy5zZXRWaWV3KCk7XG4gIH1cblxuICB0b2dnbGVBbGwoY29tcGxldGVkKSB7XG4gICAgdGhpcy5tb2RlbC5zZXRBbGxDb21wbGV0aW9uKGNvbXBsZXRlZCk7XG4gICAgdGhpcy5zZXRWaWV3KCk7XG4gIH1cblxuICB0b2dnbGVJdGVtKGlkKSB7XG4gICAgdGhpcy5tb2RlbC50b2dnbGVJdGVtKGlkKTtcbiAgICB0aGlzLnNldFZpZXcoKTtcbiAgfVxuXG4gIHJlbW92ZUl0ZW0oaWQpIHtcbiAgICB0aGlzLm1vZGVsLnJlbW92ZUl0ZW0oaWQpO1xuICAgIHRoaXMuc2V0VmlldygpO1xuICB9XG5cbiAgcmVtb3ZlQ29tcGxldGVkKCkge1xuICAgIHRoaXMubW9kZWwucmVtb3ZlQ29tcGxldGVkKCk7XG4gICAgdGhpcy5zZXRWaWV3KCk7XG4gIH1cbn1cbiIsImltcG9ydCB7IGdlbmVyVW5pcUlkIH0gZnJvbSAnLi4vaGVscGVycy9pZF9nZW5lcmF0b3InO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdG9yZU1vZGVsIHtcbiAgY29uc3RydWN0b3Ioc3RvcmFnZVZhck5hbWUpIHtcbiAgICB0aGlzLnRvZG9zID0gW107XG5cbiAgICB0aGlzLnB1c2hUb1N0b3JhZ2UgPSAoKSA9PiB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yYWdlVmFyTmFtZSwgSlNPTi5zdHJpbmdpZnkodGhpcy50b2RvcykpO1xuICAgIH07XG5cbiAgICB0aGlzLnB1bGxGcm9tU3RvcmFnZSA9ICgpID0+IHtcbiAgICAgIHRoaXMudG9kb3MgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VWYXJOYW1lKSB8fCAnW10nKTtcbiAgICB9O1xuXG4gICAgdGhpcy5wdWxsRnJvbVN0b3JhZ2UoKTtcbiAgfVxuXG4gIGdldENvbXBsZXRlZCgpIHtcbiAgICByZXR1cm4gdGhpcy50b2Rvcy5maWx0ZXIodG9kbyA9PiB0b2RvLmNvbXBsZXRlZCk7XG4gIH1cblxuICBnZXRJbmNvbXBsZXRlZCgpIHtcbiAgICByZXR1cm4gdGhpcy50b2Rvcy5maWx0ZXIodG9kbyA9PiAhdG9kby5jb21wbGV0ZWQpO1xuICB9XG5cbiAgc2V0QWxsQ29tcGxldGlvbihjb21wbGV0ZWQpIHtcbiAgICB0aGlzLnRvZG9zLmZvckVhY2goKGl0ZW0pID0+IHsgaXRlbS5jb21wbGV0ZWQgPSAhIWNvbXBsZXRlZDsgfSk7XG4gICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gIH1cblxuICBhbGxDb21wbGV0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRDb21wbGV0ZWQoKS5sZW5ndGggPT09IHRoaXMudG9kb3MubGVuZ3RoO1xuICB9XG5cbiAgcmVtb3ZlQ29tcGxldGVkKCkge1xuICAgIHRoaXMudG9kb3MgPSB0aGlzLmdldEluY29tcGxldGVkKCk7XG4gICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gIH1cblxuICBhZGRJdGVtKHRpdGxlKSB7XG4gICAgdGl0bGUgPSB0aXRsZS50cmltKCk7XG4gICAgaWYgKHRpdGxlKSB7XG4gICAgICBjb25zdCBpdGVtID0ge1xuICAgICAgICB0aXRsZSxcbiAgICAgICAgaWQ6IGdlbmVyVW5pcUlkKCksXG4gICAgICAgIGNvbXBsZXRlZDogZmFsc2UsXG4gICAgICB9O1xuICAgICAgdGhpcy50b2Rvcy5wdXNoKGl0ZW0pO1xuICAgICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0SXRlbVRpdGxlKHRpdGxlLCBpZCkge1xuICAgIHRpdGxlID0gdGl0bGUudHJpbSgpO1xuICAgIGNvbnN0IHRvZG8gPSB0aGlzLnRvZG9zLmZpbmQoaXRlbSA9PiBPYmplY3QuaXMoaXRlbS5pZCwgaWQpKTtcbiAgICBpZiAodGl0bGUpIHtcbiAgICAgIHRvZG8udGl0bGUgPSB0aXRsZTtcbiAgICAgIHRoaXMucHVzaFRvU3RvcmFnZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbW92ZUl0ZW0oaWQpO1xuICAgIH1cbiAgfVxuXG4gIHJlbW92ZUl0ZW0oaWQpIHtcbiAgICB0aGlzLnRvZG9zLmZvckVhY2goKHRvZG8sIGluZGV4KSA9PiB7XG4gICAgICBpZiAoT2JqZWN0LmlzKHRvZG8uaWQsIGlkKSkge1xuICAgICAgICB0aGlzLnRvZG9zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gIH1cblxuICB0b2dnbGVJdGVtKGlkKSB7XG4gICAgdGhpcy50b2Rvcy5mb3JFYWNoKCh0b2RvKSA9PiB7XG4gICAgICBpZiAoT2JqZWN0LmlzKHRvZG8uaWQsIGlkKSkge1xuICAgICAgICB0b2RvLmNvbXBsZXRlZCA9ICF0b2RvLmNvbXBsZXRlZDtcbiAgICAgICAgdGhpcy5wdXNoVG9TdG9yYWdlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCB7IHFzLCBzZXRMaXN0ZW5lciB9IGZyb20gJy4uL2hlbHBlcnMvaGVscGVycyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZpZXcge1xuICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZXMpIHtcbiAgICB0aGlzLnRlbXBsYXRlcyA9IHRlbXBsYXRlcztcbiAgICB0aGlzLnNlY3Rpb25Ub2RvYXBwID0gcXMoJy50b2RvYXBwJyk7XG4gICAgdGhpcy5zZWN0aW9uTWFpbiA9IHFzKCcubWFpbicsIHRoaXMuc2VjdGlvblRvZG9hcHApO1xuICAgIHRoaXMuaW5wdXROZXdUb2RvID0gcXMoJy5uZXctdG9kbycsIHRoaXMuc2VjdGlvblRvZG9hcHApO1xuICAgIHRoaXMuYnV0dG9uVG9nZ2xlQWxsID0gcXMoJy50b2dnbGUtYWxsJywgdGhpcy5zZWN0aW9uVG9kb2FwcCk7XG4gICAgdGhpcy5idXR0b25DbGVhckNvbXBsZXRlZCA9IHFzKCcuY2xlYXItY29tcGxldGVkJywgdGhpcy5zZWN0aW9uVG9kb2FwcCk7XG4gICAgdGhpcy51bFRvZG9MaXN0ID0gcXMoJy50b2RvLWxpc3QnLCB0aGlzLnNlY3Rpb25Ub2RvYXBwKTtcbiAgICB0aGlzLmNvdW50ZXIgPSBxcygnLnRvZG8tY291bnQnLCB0aGlzLnNlY3Rpb25Ub2RvYXBwKTtcbiAgICB0aGlzLmZvb3RlciA9IHFzKCcuZm9vdGVyJywgdGhpcy5zZWN0aW9uVG9kb2FwcCk7XG4gICAgdGhpcy5maWx0ZXJzID0gcXMoJy5maWx0ZXJzJywgdGhpcy5zZWN0aW9uVG9kb2FwcCk7XG4gIH1cblxuICBzZXRNYWluVmlzaWJpbGl0eSh2aXNpYmxlKSB7XG4gICAgdGhpcy5zZWN0aW9uTWFpbi5zdHlsZS5kaXNwbGF5ID0gdmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZSc7XG4gIH1cblxuICBzZXRGb290ZXJWaXNpYmlsaXR5KHZpc2libGUpIHtcbiAgICB0aGlzLmZvb3Rlci5zdHlsZS5kaXNwbGF5ID0gdmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZSc7XG4gIH1cblxuICBzZXRDbGVhckJ1dHRWaXNpYmlsaXR5KHZpc2libGUpIHtcbiAgICB0aGlzLmJ1dHRvbkNsZWFyQ29tcGxldGVkLnN0eWxlLmRpc3BsYXkgPSB2aXNpYmxlID8gJ2Jsb2NrJyA6ICdub25lJztcbiAgfVxuXG4gIHNldFRvZ2dsZUFsbFN0YXRlKGFsbENvbXBsZXRlKSB7XG4gICAgdGhpcy5idXR0b25Ub2dnbGVBbGwuY2hlY2tlZCA9IGFsbENvbXBsZXRlO1xuICB9XG5cbiAgc2V0Q2hvc2VuRmlsdGVyKHJvdXRlKSB7XG4gICAgdGhpcy5maWx0ZXJzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2EnKS5mb3JFYWNoKG5vZGUgPT4gbm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpKTtcbiAgICBsZXQgY3VyckJ1dHQ7XG4gICAgc3dpdGNoIChyb3V0ZSkge1xuICAgICAgY2FzZSAnYWN0aXZlJzpcbiAgICAgICAgY3VyckJ1dHQgPSBxcygnI3Nob3dBY3RpdmUnLCB0aGlzLmZpbHRlcnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2NvbXBsZXRlZCc6XG4gICAgICAgIGN1cnJCdXR0ID0gcXMoJyNzaG93Q29tcGxldGVkJywgdGhpcy5maWx0ZXJzKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjdXJyQnV0dCA9IHFzKCcjc2hvd0FsbCcsIHRoaXMuZmlsdGVycyk7XG4gICAgfVxuICAgIGN1cnJCdXR0LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gIH1cblxuICAvKipcbiAgICogV2lwZSBvbGQgVG9Eb3MgYW5kIHBhc3RlIHRoZSBuZXcgb25lc1xuICAgKiBAcGFyYW0gZnJhZ21lbnQgLSBkb2N1bWVudEZyYWdtZW50XG4gICAqL1xuICBzZXRMaXN0Q29udGVudChmcmFnbWVudCkge1xuICAgIGxldCBjaGlsZCA9IHRoaXMudWxUb2RvTGlzdC5maXJzdENoaWxkO1xuICAgIHdoaWxlIChjaGlsZCkge1xuICAgICAgdGhpcy51bFRvZG9MaXN0LnJlbW92ZUNoaWxkKGNoaWxkKTtcbiAgICAgIGNoaWxkID0gdGhpcy51bFRvZG9MaXN0LmZpcnN0Q2hpbGQ7XG4gICAgfVxuICAgIHRoaXMudWxUb2RvTGlzdC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gIH1cblxuICBjbGVhck5ld1RvRG9JbnB1dCgpIHtcbiAgICB0aGlzLmlucHV0TmV3VG9kby52YWx1ZSA9ICcnO1xuICB9XG5cbiAgbGlzdGVuVG9nZ2xlQWxsKGhhbmRsZXIpIHtcbiAgICBzZXRMaXN0ZW5lcih0aGlzLmJ1dHRvblRvZ2dsZUFsbCwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29tcGxldGVkID0gdGhpcy5idXR0b25Ub2dnbGVBbGwuY2hlY2tlZDtcbiAgICAgIGhhbmRsZXIoY29tcGxldGVkKTtcbiAgICB9KTtcbiAgfVxuXG4gIGxpc3Rlbk5ld1RvRG8oaGFuZGxlcikge1xuICAgIHNldExpc3RlbmVyKHRoaXMuaW5wdXROZXdUb2RvLCAnY2hhbmdlJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLmlucHV0TmV3VG9kby52YWx1ZS50cmltKCk7XG4gICAgICBpZiAodGl0bGUpIHtcbiAgICAgICAgdGhpcy5jbGVhck5ld1RvRG9JbnB1dCgpO1xuICAgICAgICBoYW5kbGVyKHRpdGxlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGxpc3RlblRvSXRlbUNoYW5nZShoYW5kbGVyKSB7XG4gICAgc2V0TGlzdGVuZXIodGhpcy51bFRvZG9MaXN0LCAnZGJsY2xpY2snLCAoeyB0YXJnZXQgfSkgPT4ge1xuICAgICAgaWYgKCFPYmplY3QuaXModGFyZ2V0LnRhZ05hbWUsICdMQUJFTCcpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbGkgPSB0YXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgICAgY29uc3QgZWRpdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICBlZGl0LmNsYXNzTGlzdC5hZGQoJ2VkaXQnKTtcbiAgICAgIGVkaXQudmFsdWUgPSB0YXJnZXQuaW5uZXJUZXh0O1xuICAgICAgbGkuYXBwZW5kQ2hpbGQoZWRpdCk7XG4gICAgICBsaS5jbGFzc0xpc3QuYWRkKCdlZGl0aW5nJyk7XG4gICAgICBlZGl0LmZvY3VzKCk7XG5cbiAgICAgIHNldExpc3RlbmVyKGVkaXQsICdibHVyJywgKCkgPT4ge1xuICAgICAgICBpZiAoIWVkaXQuZGF0YXNldC5jYW5jZWxsZWQpIHtcbiAgICAgICAgICBoYW5kbGVyKGVkaXQudmFsdWUsIGxpLmRhdGFzZXQuaWQpO1xuICAgICAgICB9XG4gICAgICAgIGxpLmNsYXNzTGlzdC5yZW1vdmUoJ2VkaXRpbmcnKTtcbiAgICAgICAgbGkucmVtb3ZlQ2hpbGQoZWRpdCk7XG4gICAgICB9KTtcblxuICAgICAgc2V0TGlzdGVuZXIoZWRpdCwgJ2tleWRvd24nLCAoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgICAgICBlZGl0LmRhdGFzZXQuY2FuY2VsbGVkID0gJ3RydWUnO1xuICAgICAgICAgIGVkaXQuYmx1cigpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgICBlZGl0LmJsdXIoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBsaXN0ZW5Ub0l0ZW1SZW1vdmUoaGFuZGxlcikge1xuICAgIHNldExpc3RlbmVyKHRoaXMudWxUb2RvTGlzdCwgJ2NsaWNrJywgKHsgdGFyZ2V0IH0pID0+IHtcbiAgICAgIGlmICghdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGVzdHJveScpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxpID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgIGhhbmRsZXIobGkuZGF0YXNldC5pZCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBsaXN0ZW5Ub1JlbW92ZUNvbXBsZXRlZChoYW5kbGVyKSB7XG4gICAgc2V0TGlzdGVuZXIodGhpcy5idXR0b25DbGVhckNvbXBsZXRlZCwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgaGFuZGxlcigpO1xuICAgIH0pO1xuICB9XG5cbiAgbGlzdGVuVG9JdGVtVG9nZ2xlKGhhbmRsZXIpIHtcbiAgICBzZXRMaXN0ZW5lcih0aGlzLnVsVG9kb0xpc3QsICdjbGljaycsICh7IHRhcmdldCB9KSA9PiB7XG4gICAgICBpZiAoIXRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3RvZ2dsZScpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxpID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgIGlmIChsaS5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbXBsZXRlZCcpKSB7XG4gICAgICAgIGxpLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbXBsZXRlZCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGkuY2xhc3NMaXN0LmFkZCgnY29tcGxldGVkJyk7XG4gICAgICB9XG4gICAgICBpZiAoaGFuZGxlcikge1xuICAgICAgICBoYW5kbGVyKGxpLmRhdGFzZXQuaWQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyTGlzdCh0b2Rvcykge1xuICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIHRvZG9zLmZvckVhY2goKHRvZG8pID0+IHtcbiAgICAgIGNvbnN0IGxpID0gdGhpcy50ZW1wbGF0ZXMuY29uc3RydWN0b3IubmV3SXRlbUxpKHRvZG8pO1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQobGkpO1xuICAgIH0pO1xuICAgIHRoaXMuc2V0TGlzdENvbnRlbnQoZnJhZ21lbnQpO1xuICB9XG5cbiAgdXBkYXRlQWN0aXZlSXRlbXNGaWVsZChhY3RpdmVJdGVtcykge1xuICAgIGNvbnN0IG5ld0NvdW50ZXIgPSB0aGlzLnRlbXBsYXRlcy5jb25zdHJ1Y3Rvci5uZXdUb2RvQ291bnRTcGFuKGFjdGl2ZUl0ZW1zKTtcbiAgICB0aGlzLmNvdW50ZXIucGFyZW50RWxlbWVudC5yZXBsYWNlQ2hpbGQobmV3Q291bnRlciwgdGhpcy5jb3VudGVyKTtcbiAgICB0aGlzLmNvdW50ZXIgPSBuZXdDb3VudGVyO1xuICB9XG59XG4iLCJpbXBvcnQgeyBxcyB9IGZyb20gJy4uL2hlbHBlcnMvaGVscGVycyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRlbXBsYXRlcyB7XG4gIHN0YXRpYyBuZXdJdGVtTGkodG9kbykge1xuICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICAgIGxpLmRhdGFzZXQuaWQgPSB0b2RvLmlkO1xuICAgIGxpLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPVwidmlld1wiPlxuICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cInRvZ2dsZVwiIHR5cGU9XCJjaGVja2JveFwiPlxuICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD4ke3RvZG8udGl0bGV9PC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiZGVzdHJveVwiPjwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gO1xuXG4gICAgaWYgKHRvZG8uY29tcGxldGVkKSB7XG4gICAgICBsaS5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTtcbiAgICAgIHFzKCcudG9nZ2xlJywgbGkpLmNoZWNrZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBsaTtcbiAgfVxuXG4gIHN0YXRpYyBuZXdUb2RvQ291bnRTcGFuKGl0ZW1zQW1vdW50KSB7XG4gICAgY29uc3QgY291bnRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICBjb25zdCBzdWZmaXggPSBpdGVtc0Ftb3VudCAlIDEwID09PSAxID8gJycgOiAncyc7XG5cbiAgICBjb3VudGVyLmNsYXNzTGlzdC5hZGQoJ3RvZG8tY291bnQnKTtcbiAgICBjb3VudGVyLmlubmVySFRNTCA9IGA8c3Ryb25nPiR7aXRlbXNBbW91bnR9PC9zdHJvbmc+IGl0ZW0ke3N1ZmZpeH0gbGVmdGA7XG5cbiAgICByZXR1cm4gY291bnRlcjtcbiAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==